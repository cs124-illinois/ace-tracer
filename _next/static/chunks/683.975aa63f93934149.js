(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[683],{6151:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function o(e){try{c(r.next(e))}catch(t){n(t)}}function a(e){try{c(r.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(343)),o=s(i(1707)),a=s(i(6624));t.default=class{constructor(...e){this._audio=new a.default,this.emitter=new n.default,this._state="paused",this.tolerance=.1,this._ace=new o.default(...e),this._audio.addStateListener((e=>{if(this._state!==e){if(this._ace.state!==e&&"paused"===e)try{this._ace.pause()}catch(t){}this.state=e}})),this.audio.player.addEventListener("ended",(()=>{this.currentTime=0})),this.audio.player.addEventListener("waiting",(()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}})),this.audio.player.addEventListener("stalled",(()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}})),this.audio.player.addEventListener("playing",(()=>{if("playing"!==this._ace.state)try{this._ace.currentTime=this._audio.currentTime,this._ace.play()}catch(e){}})),this.audio.player.addEventListener("pause",(()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}})),this.audio.player.addEventListener("timeupdate",(()=>{Math.abs(this._ace.currentTime-this._audio.currentTime)>this.tolerance&&(this._ace.currentTime=this._audio.currentTime)}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",this._state))}play(){return r(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");yield this._audio.play(),this.state="playing"}))}pause(){if("playing"!==this.state)throw new Error("Not playing");this._audio.pause(),this.state="paused"}record(){return r(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");yield this._audio.record(),yield this._ace.record(),this.state="recording"}))}stop(){return r(this,void 0,void 0,(function*(){if("recording"!==this.state)throw new Error("Not recording");if(yield this._audio.stop(),yield this._ace.stop(),Math.abs(this._audio.duration-this._ace.duration)>100)throw new Error(`Recordings do not have equal length: Audio ${this._audio.duration} <-> Ace ${this._ace.duration}`);this.state="paused"}))}addStateListener(e){this.emitter.addListener("state",e)}set src(e){if("playing"===this.state||"recording"===this.state)throw new Error("Can't change source while recording or playing");e?(this._ace.src=e.ace,this._audio.src=e.audio,this.state="paused"):(this._ace.src=void 0,this._audio.src="",this.state="empty")}get src(){return this._ace.src?{ace:this._ace.src,audio:this._audio.src}:void 0}get currentTime(){return this._audio.currentTime}set currentTime(e){this._audio.currentTime=e,this._ace.currentTime=e,this._ace.sync()}get percent(){return this._audio.percent}set percent(e){this._audio.percent=e,this._ace.percent=e,this._ace.sync()}get ace(){return this._ace}get audio(){return this._audio}set playbackRate(e){this._audio.playbackRate=e,this._ace.playbackRate=e}get playbackRate(){return this._audio.playbackRate}get duration(){return this._audio.duration}}},2136:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function o(e){try{c(r.next(e))}catch(t){n(t)}}function a(e){try{c(r.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(8817)),o=s(i(343)),a=i(9155),c=i(9739);class h extends o.default{constructor(e,t){super(),this._currentTime=0,this.currentIndex=0,this.endIndex=0,this.traceTimes=[],this.traceIndex={},this.playing=!1,this._scrollToCursor=!1,this.sessionMap={},this.editor=e,this.filterRecord=null===t||void 0===t?void 0:t.filterRecord;const i=this.editor.renderer;this.wasVisible=i.$cursorLayer.isVisible,this.wasBlinking=i.$cursorLayer.isBlinking,this.previousOpacity=i.$cursorLayer.element.style.opacity,this._playbackRate=1}set src(e){if(!e)return void(this._trace=e);if(this._trace=e,this.endIndex=e.records.length,this.traceTimes=this._trace.records.map(((t,i)=>{const r=c.Complete.guard(t),s=new Date(t.timestamp).valueOf()-new Date(e.startTime).valueOf(),n=Math.ceil(s/1e3);return r&&(this.traceIndex[n]=i),{complete:r,offset:s}})),this._trace.sessionName){this.sessionMap={};for(const{name:e,contents:t,mode:i}of this._trace.sessionInfo)this.sessionMap[e]=n.default.createEditSession(t,i);this._currentSession=this.sessionMap[this._trace.sessionName]}else this._currentSession=this.editor.session;let t=0;for(let i=0;i<Math.floor(this.traceTimes[this.endIndex-1].offset)/1e3;i++)this.traceIndex[i]?t=i:this.traceIndex[i]=t}get src(){return this._trace}play(){return r(this,void 0,void 0,(function*(){if(!this._trace)throw new Error("No trace loaded");const e=this.editor.renderer;e.$cursorLayer.isVisible=!0,e.$cursorLayer.setBlinking(!0),e.$cursorLayer.element.style.opacity=1,this.currentTime=this._currentTime/1e3,this.syncTime=(new Date).valueOf(),this.startTime=this.syncTime-this._currentTime/this.playbackRate,this.playing=!0,this.next(!1)}))}clearTimeout(){this.timer&&(clearTimeout(this.timer),this.timer=void 0,this.timerStarted=void 0)}sync(){if(!this._trace)throw new Error("Can't sync without trace");let e,t=-1;for(e=this.currentIndex;e<this.endIndex&&(t=this.startTime+this.traceTimes[e].offset/this.playbackRate-this.syncTime,!(t>0));e++){const t=this._trace.records[e];!1!==(!this.filterRecord||this.filterRecord(t))&&(c.Complete.guard(t)&&t.sessionName&&(this._currentSession=this.sessionMap[t.sessionName]),this._scrollToCursor&&c.ScrollPosition.guard(t)||(d(this.editor,t,!this._scrollToCursor),this.emit("record",t)),this._scrollToCursor&&this.editor.renderer.scrollCursorIntoView(this._currentSession.selection.getCursor()))}return this.playing&&this.currentIndex===this.endIndex&&(this.playing=!1),this.currentIndex=e,t}next(e=!0){if(!this._trace)throw new Error("Timer shouldn't fire when trace is empty");if(!this.playing)return;this.clearTimeout();const t=(new Date).valueOf();e&&(this.syncTime=t,this._currentTime=(t-this.startTime)*this._playbackRate);const i=this.sync();i>0&&(this.timerStarted=(new Date).valueOf(),this.timer=setTimeout((()=>{this.next()}),i))}pause(e=!0){if(this.timerStarted&&(this._currentTime+=((new Date).valueOf()-this.timerStarted)*this.playbackRate),this.clearTimeout(),this.playing=!1,e){const e=this.editor.renderer;e.$cursorLayer.element.style.opacity=this.previousOpacity,e.$cursorLayer.setBlinking(this.wasBlinking),e.$cursorLayer.isVisible=this.wasVisible}}get duration(){return this._trace.duration/1e3}get currentTime(){return this.playing?((new Date).valueOf()-this.startTime)*this.playbackRate/1e3:this._currentTime/1e3}set currentTime(e){if(e<0||e>this.duration+.1)throw new Error(`Bad timestamp: ${e}`);const t=1e3*e;this.syncTime=(new Date).valueOf(),this.startTime=this.syncTime-t/this.playbackRate;let i=-1;const r=Math.floor(e),s=this.traceIndex[r];if(void 0===s)throw new Error(`Couldn't find index for ${r}: ${e}`);if(this.traceTimes[s].offset>t)throw new Error(`Bad index value: ${s}`);for(let n=s;n<this.traceTimes.length;n++){const e=this.traceTimes[n];if(e.complete){if(e.offset>t)break;i=n}}this.currentIndex=i,this._currentTime=t}get playbackRate(){return this._playbackRate}set playbackRate(e){const t=this.playing;this.playing&&this.pause(!1),this._playbackRate=e,t&&this.play()}set scrollToCursor(e){this._scrollToCursor=e}get scrollToCursor(){return this._scrollToCursor}}t.default=h;const d=(e,t,i=!0)=>{c.Complete.guard(t)?l(e.session,t,i):a.Delta.guard(t)?u(e.session,t):a.SelectionChange.guard(t)?p(e.session,t):a.CursorChange.guard(t)?f(e.session,t):a.ScrollChange.guard(t)&&m(e.renderer,t)},l=(e,t,i=!0)=>{e.getValue()!==t.value&&g(e,t.value);const{row:r,column:s}=t.cursor;e.selection.moveCursorTo(r,s);const{start:n,end:o}=t.selection;if(e.selection.setSelectionRange({start:{row:n.row,column:n.column},end:{row:o.row,column:o.column}}),i){const{top:i,left:r}=t.scroll;e.setScrollTop(i),e.setScrollLeft(r)}},u=(e,t)=>e.getDocument().applyDelta(t),p=(e,t)=>e.selection.setSelectionRange(t),f=(e,t)=>e.selection.moveCursorTo(t.location.row,t.location.column),m=(e,t)=>{e.scrollToY(t.top),e.scrollToX(t.left)},g=(e,t)=>{const i=e.selection.toJSON();e.setValue(t),e.selection.fromJSON(i)}},1707:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function o(e){try{c(r.next(e))}catch(t){n(t)}}function a(e){try{c(r.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(343)),o=s(i(2136)),a=s(i(9974));class c extends o.default{constructor(e,t){var i;super(null!==(i=null===t||void 0===t?void 0:t.replayEditor)&&void 0!==i?i:e,{filterRecord:null===t||void 0===t?void 0:t.filterRecord}),this._state="paused",this.emitter=new n.default,this.stopping=!1,this.recorder=new a.default(e)}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",e))}get state(){return this._state}play(){const e=Object.create(null,{play:{get:()=>super.play}});return r(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");yield e.play.call(this),this.state="playing"}))}pause(){if("playing"!==this.state)throw new Error("Not playing");super.pause(),this.state="paused"}record(){return r(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");this.recorder.start(),this.state="recording"}))}stop(){return r(this,void 0,void 0,(function*(){if("recording"!==this.state)throw new Error("Not recording");this.recorder.stop(),this.stopping=!0,this.src=this.recorder.src,this.state="paused",this.stopping=!1}))}addStateListener(e){this.emitter.addListener("state",e)}get percent(){return this.currentTime/this.duration*100}set percent(e){this.currentTime=this.duration*e/100}set src(e){if(!this.stopping&&("playing"===this.state||"recording"===this.state))throw new Error("Can't change src while playing or recording");super.src=e,this.state=e?"paused":"empty"}get src(){return super.src}}t.default=c},9974:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function o(e){try{c(r.next(e))}catch(t){n(t)}}function a(e){try{c(r.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(8817)),o=s(i(343)),a=i(9155),c=i(9739),h=s(i(8494));class d extends o.default{constructor(e,t){super(),this.recording=!1,this.records=[],this.sessionMap={},this.sessionInfo=[],this.editor=e,this.streamer=new h.default(e),this.options=t}start(){var e;return r(this,void 0,void 0,(function*(){const t=(null===(e=this.options)||void 0===e?void 0:e.completeInterval)||1e3;if(this.records=[],this.src=void 0,0===Object.keys(this.sessionMap).length||!this.sessionName)throw new Error("Session information not properly configured");this.sessionInfo=Object.entries(this.sessionMap).map((([e,t])=>({name:e,contents:t.session.getValue(),mode:t.mode}))),this.startSession=this.sessionName,this.streamer.start((e=>{this.records.push(e),this.emit("record",e)})),this.timer=setInterval((()=>{this.addCompleteRecord("timer")}),t),this.recording=!0}))}stop(){return r(this,void 0,void 0,(function*(){if(!this.recording)throw new Error("Not recording");this.timer&&clearInterval(this.timer),this.streamer.stop(),this.src=new c.AceTrace([...this.records],this.sessionInfo,this.startSession)}))}addExternalChange(e){if(!this.recording)throw new Error("Not recording");if(void 0!==e.type)throw new Error("type property in external changes is overwritten");const t=c.ExternalChange.check(Object.assign(Object.assign({},e),{type:"external",timestamp:new Date}));this.records.push(t),this.emit("record",t)}addCompleteRecord(e="manual"){if(!this.recording)throw new Error("Not recording");const t=l(this.editor,e,this.sessionName);this.records.push(t),this.emit("record",t)}addSession(e){const{name:t,contents:i,mode:r}=e;if(this.sessionMap[t])throw new Error(`Session ${t} already exists`);this.sessionMap[t]={session:n.default.createEditSession(i,r),mode:r}}addSessions(e){for(const t of e)this.addSession(t)}setSession(e){if(!this.sessionMap[e])throw new Error(`Session ${e} does not exist`);this.sessionName=this.streamer.sessionName=e,this.editor.setSession(this.sessionMap[e].session)}singleSession(e){if(Object.keys(this.sessionMap).length>0)throw new Error("Session map must be empty when calling singleSession");this.addSession(e),this.sessionName=e.name}}const l=(e,t,i)=>{const r=e.renderer,{width:s,height:n}=r.$size;return a.Complete.check(Object.assign({type:"complete",timestamp:new Date,focused:e.isFocused(),value:e.session.getValue(),selection:e.session.selection.getRange(),cursor:e.session.selection.getCursor(),scroll:{top:e.renderer.getScrollTop(),left:e.renderer.getScrollLeft()},window:{width:s,height:n,rows:e.renderer.getScrollBottomRow()-e.renderer.getScrollTopRow()+1,fontSize:parseInt(e.getFontSize()),lineHeight:r.$textLayer.getLineHeight()},reason:t},i&&{sessionName:i}))};t.default=d},8494:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});const r=i(2691),s=i(9155),n=i(9739);t.default=class{constructor(e){this._stop=()=>{},this.running=!1,this.editor=e}start(e){let t=this.editor.getValue();const i=i=>{this.running&&this.editor.getValue()!==t&&(t=this.editor.getValue(),e(n.Delta.check(Object.assign({type:"delta",timestamp:new Date,focused:this.editor.isFocused()},i))))};let s=n.Selection.check(this.editor.selection.getRange());const d=(0,r.throttle)(100,(()=>{if(!this.running)return;const t=n.Selection.check(this.editor.selection.getRange());a(t,s)||h(t)?s=t:(s=t,e(n.SelectionChange.check(Object.assign({type:"selectionchange",timestamp:new Date,focused:this.editor.isFocused()},t))))}));let l=n.EditorLocation.check(this.editor.selection.getCursor());const u=(0,r.throttle)(100,(()=>{if(!this.running)return;const t=n.EditorLocation.check(this.editor.selection.getCursor());!o(t,l)&&h(this.editor.selection.getRange())?(l=t,e(n.CursorChange.check({type:"cursorchange",timestamp:new Date,focused:this.editor.isFocused(),location:t}))):l=t}));let p=n.ScrollPosition.check({top:this.editor.renderer.getScrollTop(),left:this.editor.renderer.getScrollLeft()});const f=(0,r.throttle)(100,(()=>{if(!this.running)return;const t=n.ScrollPosition.check({top:this.editor.renderer.getScrollTop(),left:this.editor.renderer.getScrollLeft()});t.top===p.top&&t.left===p.left||(p=t,e(n.ScrollChange.check(Object.assign({type:"scrollchange",timestamp:new Date,focused:this.editor.isFocused()},t))))})),m=this.editor.renderer,{width:g,height:w}=m.$size;let y=n.WindowSize.check({width:g,height:w,rows:this.editor.renderer.getScrollBottomRow()-this.editor.renderer.getScrollTopRow()+1,fontSize:parseInt(this.editor.getFontSize()),lineHeight:m.$textLayer.getLineHeight()});const v=(0,r.throttle)(100,(()=>{if(!this.running)return;const{width:t,height:i}=m.$size,r=n.WindowSize.check({width:t,height:i,rows:this.editor.renderer.getScrollBottomRow()-this.editor.renderer.getScrollTopRow()+1,fontSize:parseInt(this.editor.getFontSize()),lineHeight:m.$textLayer.getLineHeight()});r.width===y.width&&r.height===y.height&&r.rows===y.rows&&r.fontSize===y.fontSize&&r.lineHeight===y.lineHeight||(y=r,e(n.WindowSizeChange.check(Object.assign({type:"windowsizechange",timestamp:new Date,focused:this.editor.isFocused()},r))))})),_=({session:t,oldSession:r})=>{if(r.removeEventListener("change",i),r.removeEventListener("changeScrollTop",f),r.removeEventListener("changeScrollTop",v),!this.sessionName)throw new Error("Must set sessionName if switching sessions during recording");e(c(this.editor,"session",this.sessionName)),t.addEventListener("change",i),t.addEventListener("changeScrollTop",f),t.addEventListener("changeScrollTop",v)};e(c(this.editor,"start",this.sessionName)),this.editor.session.addEventListener("change",i),this.editor.addEventListener("changeSelection",d),this.editor.addEventListener("changeSelection",u),this.editor.session.addEventListener("changeScrollTop",f),this.editor.renderer.addEventListener("changeScrollTop",v),this.editor.addEventListener("changeSession",_),this.running=!0,this._stop=()=>{this.editor.session.removeEventListener("change",i),this.editor.removeEventListener("changeSelection",d),this.editor.removeEventListener("changeSelection",u),this.editor.session.removeEventListener("changeScrollTop",f),this.editor.session.removeEventListener("changeScrollTop",v),this.editor.removeEventListener("changeSession",_),e(c(this.editor,"end",this.sessionName)),this.running=!1}}stop(){if(!this.running)throw new Error("Not running");this._stop()}};const o=(e,t)=>e.column===t.column&&e.row===t.row,a=(e,t)=>o(e.start,t.start)&&o(e.end,t.end),c=(e,t,i)=>{const r=e.renderer,{width:n,height:o}=r.$size;return s.Complete.check(Object.assign({type:"complete",timestamp:new Date,focused:e.isFocused(),value:e.session.getValue(),selection:e.session.selection.getRange(),cursor:e.session.selection.getCursor(),scroll:{top:e.renderer.getScrollTop(),left:e.renderer.getScrollLeft()},window:{width:n,height:o,rows:e.renderer.getScrollBottomRow()-e.renderer.getScrollTopRow()+1,fontSize:parseInt(e.getFontSize()),lineHeight:r.$textLayer.getLineHeight()},reason:t},i&&{sessionName:i}))},h=e=>e.start.column===e.end.column&&e.start.row===e.end.row},6624:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function o(e){try{c(r.next(e))}catch(t){n(t)}}function a(e){try{c(r.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(343)),o=s(i(3285));t.default=class{constructor(){this.recorder=new o.default,this._state="paused",this.emitter=new n.default,this.stopping=!1,this.player=new Audio,this.player.addEventListener("ended",(()=>{this.state="paused"}))}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",e))}get state(){return this._state}play(){return r(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");yield this.player.play(),this.state="playing"}))}pause(){if("playing"!==this.state)throw new Error("Not playing");this.player.pause(),this.state="paused"}record(){return r(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");yield this.recorder.start(),this.state="recording"}))}stop(){return r(this,void 0,void 0,(function*(){if("recording"!==this.state)throw new Error("Not recording");yield this.recorder.stop(),this.stopping=!0,this.src=this.recorder.src,this.state="paused",this.stopping=!1}))}set src(e){if(!this.stopping&&("playing"===this.state||"recording"===this.state))throw new Error("Can't change src while playing or recording");this.player.src=e,""!==e?(this.player.load(),this.state="paused"):this.state="empty"}get src(){return this.player.src}addStateListener(e){this.emitter.addListener("state",e)}get currentTime(){return this.player.currentTime}set currentTime(e){this.player.currentTime=e}get percent(){return this.player.currentTime/this.player.duration*100}set percent(e){this.player.currentTime=this.player.duration*e/100}get playbackRate(){return this.player.playbackRate}set playbackRate(e){this.player.playbackRate=e}get duration(){return this.player.duration}}},3285:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function o(e){try{c(r.next(e))}catch(t){n(t)}}function a(e){try{c(r.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(1012)),o=s(i(5149));t.default=class{constructor(){this.started=0,this.chunks=[]}start(){return r(this,void 0,void 0,(function*(){return this.recorder=new MediaRecorder(yield navigator.mediaDevices.getUserMedia({audio:!0})),this.listener=({data:e})=>{e&&e.size>0&&this.chunks.push(e)},this.recorder.addEventListener("dataavailable",this.listener),this.blob=void 0,new Promise(((e,t)=>{this.blob=void 0,this.recorder.addEventListener("start",(()=>{this.chunks=[],this.started=Date.now(),e()}),{once:!0}),this.recorder.addEventListener("error",t,{once:!0}),this.recorder.start(1e3)}))}))}stop(){return r(this,void 0,void 0,(function*(){return new Promise((e=>{this.recorder.addEventListener("stop",(()=>r(this,void 0,void 0,(function*(){const t=Date.now()-this.started;this.recorder.removeEventListener("dataavailable",this.listener),this.recorder.stream.getTracks()[0].stop(),this.blob=new Blob(this.chunks,{type:this.recorder.mimeType});"webm"===new o.default(this.recorder.mimeType).subtype&&(this.blob=yield(0,n.default)(new Blob(this.chunks,{type:this.recorder.mimeType}),t,{logger:!1})),e()}))),{once:!0}),this.recorder.stop()}))}))}get src(){return this.blob&&URL.createObjectURL(this.blob)}}},9155:function(e,t,i){var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)},n=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function o(e){try{c(r.next(e))}catch(t){n(t)}}function a(e){try{c(r.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.urlToBase64=t.AudioRecordReplayer=t.AudioRecorder=t.AceRecordReplayer=t.AceRecorder=t.AcePlayer=t.AceStreamer=void 0;const a=o(i(8494));t.AceStreamer=a.default;const c=o(i(2136));t.AcePlayer=c.default;const h=o(i(9974));t.AceRecorder=h.default;const d=o(i(1707));t.AceRecordReplayer=d.default;const l=o(i(3285));t.AudioRecorder=l.default;const u=o(i(6624));t.AudioRecordReplayer=u.default;const p=o(i(6151));s(i(9739),t),t.default=p.default;t.urlToBase64=e=>n(this,void 0,void 0,(function*(){const t=yield fetch(e).then((e=>e.blob()));return new Promise((e=>{const i=new FileReader;i.onloadend=()=>e(i.result.toString().split(",")[1]),i.readAsDataURL(t)}))}))},9739:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeAceRecordTimestamp=t.AceTrace=t.AceTraceContent=t.AceRecord=t.ExternalChange=t.SessionInfo=t.WindowSizeChange=t.WindowSize=t.ScrollChange=t.ScrollPosition=t.CursorChange=t.SelectionChange=t.Selection=t.Delta=t.Complete=t.EditorLocation=t.AceTimestamp=void 0;const r=i(4690);t.AceTimestamp=(0,r.Union)((0,r.InstanceOf)(Date),r.String.withConstraint((e=>!isNaN(Date.parse(e).valueOf())))),t.EditorLocation=(0,r.Record)({row:r.Number,column:r.Number}),t.Complete=(0,r.Record)({type:(0,r.Literal)("complete"),timestamp:t.AceTimestamp,focused:r.Boolean,value:r.String,selection:(0,r.Record)({start:t.EditorLocation,end:t.EditorLocation}),cursor:t.EditorLocation,scroll:(0,r.Record)({top:r.Number,left:r.Number}),window:(0,r.Record)({width:r.Number,height:r.Number,rows:r.Number,fontSize:r.Number,lineHeight:r.Number}),reason:(0,r.Union)((0,r.Literal)("start"),(0,r.Literal)("timer"),(0,r.Literal)("end"),(0,r.Literal)("manual"),(0,r.Literal)("session"))}).And((0,r.Partial)({sessionName:r.String})),t.Delta=(0,r.Record)({type:(0,r.Literal)("delta"),timestamp:t.AceTimestamp,focused:r.Boolean,start:t.EditorLocation,end:t.EditorLocation,action:(0,r.Union)((0,r.Literal)("insert"),(0,r.Literal)("remove")),lines:(0,r.Array)(r.String)}).And((0,r.Partial)({id:r.Number})),t.Selection=(0,r.Record)({start:t.EditorLocation,end:t.EditorLocation}),t.SelectionChange=(0,r.Record)({type:(0,r.Literal)("selectionchange"),timestamp:t.AceTimestamp,focused:r.Boolean,start:t.EditorLocation,end:t.EditorLocation}),t.CursorChange=(0,r.Record)({type:(0,r.Literal)("cursorchange"),timestamp:t.AceTimestamp,focused:r.Boolean,location:t.EditorLocation}),t.ScrollPosition=(0,r.Record)({top:r.Number,left:r.Number}),t.ScrollChange=(0,r.Record)({type:(0,r.Literal)("scrollchange"),timestamp:t.AceTimestamp,focused:r.Boolean,top:r.Number,left:r.Number}),t.WindowSize=(0,r.Record)({width:r.Number,height:r.Number,rows:r.Number,fontSize:r.Number,lineHeight:r.Number}),t.WindowSizeChange=(0,r.Record)({type:(0,r.Literal)("windowsizechange"),timestamp:t.AceTimestamp,focused:r.Boolean,rows:r.Number}),t.SessionInfo=(0,r.Record)({name:r.String,contents:r.String,mode:r.String}),t.ExternalChange=(0,r.Record)({type:(0,r.Literal)("external"),timestamp:t.AceTimestamp}),t.AceRecord=(0,r.Union)(t.Complete,t.Delta,t.SelectionChange,t.CursorChange,t.ScrollChange,t.WindowSizeChange,t.ExternalChange),t.AceTraceContent=(0,r.Record)({records:(0,r.Array)(t.AceRecord),duration:r.Number,startTime:t.AceTimestamp,sessionInfo:(0,r.Array)(t.SessionInfo)}).And((0,r.Partial)({sessionName:r.String}));t.AceTrace=class{constructor(e,i,r){if(0===e.length)throw new Error("Empty trace");if(this.records=e,this.startTime=new Date(e[0].timestamp),this.duration=new Date(e.slice(-1)[0].timestamp).valueOf()-new Date(e[0].timestamp).valueOf(),i.find((({name:e})=>!e)))throw new Error("Session names must not be blank");if(!i.find((({name:e})=>e===r)))throw new Error("Must set sessionName when trace includes multiple sessions");this.sessionInfo=i,this.sessionName=r,t.AceTraceContent.check(this)}};t.deserializeAceRecordTimestamp=e=>(e.timestamp=new Date(e.timestamp),e)},3683:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return m}});var r=i(5156),s=i.n(r),n=i(4246),o=i(9155),a=i.n(o),c=i(7378),h=i(2329),d=i(7118),l=i.n(d);function u(e,t,i,r,s,n,o){try{var a=e[n](o),c=a.value}catch(h){return void i(h)}a.done?t(c):Promise.resolve(c).then(r,s)}function p(e){return function(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var f=[{name:"Hello, world!",stem:"helloworld",audio:["webm","mp4"]}],m=function(){var e=(0,c.useState)(),t=e[0],i=e[1],r=(0,c.useState)([]),d=r[0],m=r[1],g=(0,c.useRef)(),w=(0,c.useRef)(),y=(0,c.useState)(void 0),v=y[0],_=y[1],S=(0,c.useState)("paused"),b=S[0],T=S[1],L=(0,c.useState)("Main.java"),E=L[0],x=L[1],R=(0,c.useState)(),C=R[0],j=R[1];(0,c.useEffect)((function(){null===v||void 0===v||v.addStateListener((function(e){return T(e)}))}),[v]),(0,c.useEffect)((function(){"empty"===b?(m([]),j(void 0)):"recording"===b&&i(void 0)}),[b,v]);var N,k,A=(0,c.useState)(!1),O=(A[0],A[1]),M=((0,c.useCallback)((N=s().mark((function e(){var t,i,r,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v&&v.src){e.next=2;break}return e.abrupt("return");case 2:return O(!0),t=v.src,i=t.ace,r=t.audio,e.next=6,(0,o.urlToBase64)(r);case 6:n=e.sent,fetch("/api/",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({ace:i,audio:n})}).finally((function(){O(!1)}));case 8:case"end":return e.stop()}}),e)})),function(){var e=this,t=arguments;return new Promise((function(i,r){var s=N.apply(e,t);function n(e){u(s,i,r,n,o,"next",e)}function o(e){u(s,i,r,n,o,"throw",e)}n(void 0)}))}),[v]),(0,c.useCallback)((function(){if(g.current&&w.current){var e=new(a())(g.current,{replayEditor:w.current});e.ace.scrollToCursor=!0,e.ace.recorder.addListener("record",(function(e){m((function(t){return[e].concat(p(t))}))})),e.ace.addListener("record",(function(e){o.Complete.guard(e)&&j(e.sessionName)})),e.ace.recorder.addSessions([{name:"Main.java",contents:"",mode:"ace/mode/java"},{name:"Another.java",contents:"",mode:"ace/mode/java"}]),e.ace.recorder.setSession("Main.java"),_(e)}}),[]));return(0,c.useEffect)((function(){null===v||void 0===v||v.ace.recorder.setSession(E)}),[E,v]),(0,c.useEffect)((function(){var e;t&&v&&fetch("".concat(null!==(e="/ace-tracer")?e:"","/").concat(t.stem,".json")).then((function(e){return e.json()})).then((function(e){var i,r=o.AceTraceContent.check(e);v.src={ace:r,audio:"".concat(null!==(i="/ace-tracer")?i:"","/").concat(t.stem,".mp4")}}))}),[t,v]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{children:"Use the record button to start recording, and play to replay when you are finished."}),(0,n.jsxs)("select",{id:"language",onChange:function(e){return i(f.find((function(t){return t.stem===e.target.value})))},value:null!==(k=null===t||void 0===t?void 0:t.stem)&&void 0!==k?k:"",children:[(0,n.jsx)("option",{value:""},""),f.map((function(e){var t=e.name,i=e.stem;return(0,n.jsx)("option",{value:i,children:t},i)}))]}),v&&!1,(0,n.jsx)("div",{style:{display:"flex"},children:"recording"===b&&(0,n.jsx)(l(),{children:function(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l().Minutes,{}),":",(0,n.jsx)(l().Seconds,{})]})}})}),(0,n.jsx)("span",{children:"Record"}),(0,n.jsx)(h.ZP,{mode:"java",theme:"github",width:"100%",minLines:4,maxLines:4,showPrintMargin:!1,onBeforeLoad:function(e){e.config.set("basePath","https://cdn.jsdelivr.net/npm/ace-builds@".concat(e.version,"/src-min-noconflict"))},onLoad:function(e){g.current=e,M()}}),(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"row",marginBottom:8},children:[(0,n.jsx)("button",{onClick:function(){return x("Main.java")},children:(0,n.jsx)("kbd",{style:{fontWeight:"Main.java"===E?"bold":"inherit"},children:"Main.java"})}),(0,n.jsx)("button",{onClick:function(){return x("Another.java")},children:(0,n.jsx)("kbd",{style:{fontWeight:"Another.java"===E?"bold":"inherit"},children:"Another.java"})})]}),(0,n.jsx)("span",{children:"Play"}),(0,n.jsx)(h.ZP,{mode:"java",theme:"github",width:"100%",readOnly:!0,minLines:2,maxLines:2,showPrintMargin:!1,onBeforeLoad:function(e){e.config.set("basePath","https://cdn.jsdelivr.net/npm/ace-builds@".concat(e.version,"/src-min-noconflict"))},onLoad:function(e){w.current=e,M()}}),(0,n.jsx)("div",{children:(0,n.jsx)("span",{children:null!==C&&void 0!==C?C:(0,n.jsx)(n.Fragment,{children:"\xa0"})})}),(0,n.jsx)("div",{style:{height:"16rem",overflow:"scroll",marginTop:8},children:d.filter((function(e){return!o.Complete.guard(e)||"timer"!==e.reason})).map((function(e,t){return(0,n.jsx)("pre",{children:JSON.stringify(e,null,2)},t)}))})]})}}}]);