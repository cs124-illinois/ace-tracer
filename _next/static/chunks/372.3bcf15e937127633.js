"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[372],{8555:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(s,n){function a(e){try{c(r.next(e))}catch(e){n(e)}}function o(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=s(i(1339)),a=s(i(1257)),o=s(i(6624));t.default=class{constructor(...e){this._audio=new o.default,this.emitter=new n.default,this._state="paused",this.tolerance=.1,this.hasRecording=!1,this._ace=new a.default(...e),this._audio.addStateListener(e=>{if(this._state!==e){if(this._ace.state!==e&&"paused"===e)try{this._ace.pause()}catch(e){}this.state=e}}),this.audio.player.addEventListener("ended",()=>{this.currentTime=0,this.emitter.emit("event","ended")}),this.audio.player.addEventListener("waiting",()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}}),this.audio.player.addEventListener("stalled",()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}}),this.audio.player.addEventListener("playing",()=>{if("playing"!==this._ace.state)try{this._ace.currentTime=this._audio.currentTime,this._ace.play()}catch(e){}}),this.audio.player.addEventListener("pause",()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}}),this.audio.player.addEventListener("timeupdate",()=>{Math.abs(this._ace.currentTime-this._audio.currentTime)>this.tolerance&&(this._ace.currentTime=this._audio.currentTime)})}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",this._state))}play(){return r(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");yield this._audio.play(),this.state="playing"})}pause(){if("playing"!==this.state)throw Error("Not playing");this._audio.pause(),this.state="paused"}record(){return r(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");yield this._audio.record(),yield this._ace.record(),this.state="recording",this.emitter.emit("event","startedRecording")})}stop(){return r(this,void 0,void 0,function*(){if("recording"!==this.state)throw Error("Not recording");if(this.hasRecording=!0,yield this._audio.stop(),yield this._ace.stop(),Math.abs(this._audio.duration-this._ace.duration)>100)throw this.hasRecording=!1,Error(`Recordings do not have equal length: Audio ${this._audio.duration} <-> Ace ${this._ace.duration}`);this.hasRecording&&this.emitter.emit("event","srcChanged"),this.state="paused"})}addStateListener(e){this.emitter.addListener("state",e)}addEventListener(e){this.emitter.addListener("event",e)}set src(e){if("playing"===this.state||"recording"===this.state)throw Error("Can't change source while recording or playing");this._ace.src=e?e.ace:void 0,this._audio.src=e?e.audio:"",this.hasRecording=!1,this.state="paused",this.emitter.emit("event","srcChanged")}get src(){if("recording"===this.state)throw Error("Still recording");return this._ace.src?{ace:this._ace.src,audio:this._audio.src}:void 0}get currentTime(){return this._audio.currentTime}set currentTime(e){this._audio.currentTime=e,this._ace.currentTime=e,this._ace.sync(),this.emitter.emit("event","seeked")}get percent(){return this._audio.percent}set percent(e){this._audio.percent=e,this._ace.percent=e,this._ace.sync(),this.emitter.emit("event","seeked")}get ace(){return this._ace}get audio(){return this._audio}set playbackRate(e){this._audio.playbackRate=e,this._ace.playbackRate=e,this.emitter.emit("event","playbackRateChange")}get playbackRate(){return this._audio.playbackRate}get duration(){return this._audio.duration}}},6151:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(s,n){function a(e){try{c(r.next(e))}catch(e){n(e)}}function o(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=s(i(1339)),a=s(i(1707)),o=s(i(6624));t.default=class{constructor(...e){this._audio=new o.default,this.emitter=new n.default,this._state="paused",this.tolerance=.1,this.hasRecording=!1,this._ace=new a.default(...e),this._audio.addStateListener(e=>{if(this._state!==e){if(this._ace.state!==e&&"paused"===e)try{this._ace.pause()}catch(e){}this.state=e}}),this.audio.player.addEventListener("ended",()=>{this.currentTime=0,this.emitter.emit("event","ended")}),this.audio.player.addEventListener("waiting",()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}}),this.audio.player.addEventListener("stalled",()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}}),this.audio.player.addEventListener("playing",()=>{if("playing"!==this._ace.state)try{this._ace.currentTime=this._audio.currentTime,this._ace.play()}catch(e){}}),this.audio.player.addEventListener("pause",()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}}),this.audio.player.addEventListener("timeupdate",()=>{Math.abs(this._ace.currentTime-this._audio.currentTime)>this.tolerance&&(this._ace.currentTime=this._audio.currentTime)})}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",this._state))}play(){return r(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");if(!this.src)throw Error("No source");yield this._audio.play(),this.state="playing"})}pause(){if("playing"!==this.state)throw Error("Not playing");this._audio.pause(),this.state="paused"}record(){return r(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");yield this._audio.record(),yield this._ace.record(),this.state="recording",this.emitter.emit("event","startedRecording")})}stop(){return r(this,void 0,void 0,function*(){if("recording"!==this.state)throw Error("Not recording");if(this.hasRecording=!0,yield this._audio.stop(),yield this._ace.stop(),Math.abs(this._audio.duration-this._ace.duration)>100)throw this.hasRecording=!1,Error(`Recordings do not have equal length: Audio ${this._audio.duration} <-> Ace ${this._ace.duration}`);this.hasRecording&&this.emitter.emit("event","srcChanged"),this.state="paused"})}addStateListener(e){this.emitter.addListener("state",e)}addEventListener(e){this.emitter.addListener("event",e)}set src(e){if("playing"===this.state||"recording"===this.state)throw Error("Can't change source while recording or playing");this._ace.src=e?e.ace:void 0,this._audio.src=e?e.audio:"",this.hasRecording=!1,this.state="paused",this.emitter.emit("event","srcChanged")}get src(){if("recording"===this.state)throw Error("Still recording");return this._ace.src?{ace:this._ace.src,audio:this._audio.src}:void 0}get currentTime(){return this._audio.currentTime}set currentTime(e){this._audio.currentTime=e,this._ace.currentTime=e,this._ace.sync(),this.emitter.emit("event","seeked")}get percent(){return this._audio.percent}set percent(e){this._audio.percent=e,this._ace.percent=e,this._ace.sync(),this.emitter.emit("event","seeked")}get ace(){return this._ace}get audio(){return this._audio}set playbackRate(e){this._audio.playbackRate=e,this._ace.playbackRate=e,this.emitter.emit("event","playbackRateChange")}get playbackRate(){return this._audio.playbackRate}get duration(){return this._audio.duration}}},1257:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(s,n){function a(e){try{c(r.next(e))}catch(e){n(e)}}function o(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=s(i(1339)),a=s(i(2136)),o=s(i(9974));t.default=class{constructor(e,t){for(let i of(this.players={},this.recorders={},this._state="paused",this.emitter=new n.default,this.stopping=!1,this.hasRecording=!1,Object.keys(e)))this.players[i]=new a.default((null==t?void 0:t.replayEditors)?t.replayEditors[i]:e[i],{filterRecord:e=>null==t||!t.filterRecord||t.filterRecord(e,i)}),this.recorders[i]=new o.default(e[i])}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",e))}get state(){return this._state}play(){return r(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");for(let e of Object.keys(this.players))yield this.players[e].play();this.state="playing"})}pause(){if("playing"!==this.state)throw Error("Not playing");for(let e of Object.keys(this.players))this.players[e].pause();this.state="paused"}sync(){for(let e of Object.keys(this.players))this.players[e].sync()}record(){return r(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");for(let e of Object.keys(this.recorders))this.recorders[e].start();this.state="recording",this.hasRecording=!0})}stop(){return r(this,void 0,void 0,function*(){if("recording"!==this.state)throw Error("Not recording");this.stopping=!0;let e={};for(let t of Object.keys(this.recorders))this.recorders[t].stop(),e[t]=this.recorders[t].src;this.src=e,this.state="paused",this.stopping=!1})}addStateListener(e){this.emitter.addListener("state",e)}addEventListener(e){this.emitter.addListener("event",e)}get currentTime(){return this.players[Object.keys(this.players)[0]].currentTime}set currentTime(e){for(let t of Object.keys(this.players))this.players[t].currentTime=e}get playbackRate(){return this.players[Object.keys(this.players)[0]].playbackRate}set playbackRate(e){for(let t of Object.keys(this.players))this.players[t].playbackRate=e}get duration(){return this.players[Object.keys(this.players)[0]].duration}get percent(){return this.currentTime/this.duration*100}set percent(e){this.currentTime=this.duration*e/100}set src(e){if(!this.stopping&&("playing"===this.state||"recording"===this.state))throw Error("Can't change src while playing or recording");if(this._src=e,e)for(let t of Object.keys(e))this.players[t].src=e[t];this.state="paused",this.hasRecording=!1}get src(){if("recording"===this.state)throw Error("Still recording");return this._src}}},2136:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(s,n){function a(e){try{c(r.next(e))}catch(e){n(e)}}function o(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=i(8741),a=s(i(8817)),o=s(i(1339)),c=i(9155);class h extends o.default{constructor(e,t){super(),this._currentTime=0,this.currentIndex=0,this.endIndex=0,this.traceTimes=[],this.traceIndex={},this.playing=!1,this.scrollToCursor=!1,this.sessionMap={},this._editor=e,this.filterRecord=null==t?void 0:t.filterRecord;let i=this._editor.renderer;this.wasVisible=i.$cursorLayer.isVisible,this.wasBlinking=i.$cursorLayer.isBlinking,this.previousOpacity=i.$cursorLayer.element.style.opacity,this._playbackRate=1}set src(e){if(!e){this._trace=e;return}if(this._trace=e,this.endIndex=e.records.length,this.traceTimes=this._trace.records.map((t,i)=>{let r=n.Complete.guard(t),s=new Date(t.timestamp).valueOf()-new Date(e.startTime).valueOf();return r&&(this.traceIndex[Math.ceil(s/1e3)]=i),{complete:r,offset:s}}),this._trace.sessionName){for(let{name:e,contents:t,mode:i}of(this.sessionMap={},this._trace.sessionInfo))this.sessionMap[e]=a.default.createEditSession(t,i);this._editor.setSession(this.sessionMap[this._trace.sessionName])}let t=0;for(let e=0;e<Math.floor(this.traceTimes[this.endIndex-1].offset)/1e3;e++)this.traceIndex[e]?t=e:this.traceIndex[e]=t}get src(){return this._trace}play(){return r(this,void 0,void 0,function*(){if(!this._trace)throw Error("No trace loaded");let e=this._editor.renderer;e.$cursorLayer.isVisible=!0,e.$cursorLayer.setBlinking(!0),e.$cursorLayer.element.style.opacity=1,this.currentTime=this._currentTime/1e3,this.syncTime=new Date().valueOf(),this.startTime=this.syncTime-this._currentTime/this.playbackRate,this.playing=!0,this.next(!1)})}clearTimeout(){this.timer&&(clearTimeout(this.timer),this.timer=void 0,this.timerStarted=void 0)}sync(){let e;if(!this._trace)throw Error("Can't sync without trace");let t=-1;for(e=this.currentIndex;e<this.endIndex&&!((t=this.startTime+this.traceTimes[e].offset/this.playbackRate-this.syncTime)>0);e++){let t=this._trace.records[e],i=!this.filterRecord||this.filterRecord(t);!1!==i&&(n.Complete.guard(t)&&t.sessionName&&this._editor.setSession(this.sessionMap[t.sessionName]),n.ScrollPosition.guard(t)&&this.scrollToCursor&&t.triggeredByCursorChange||(d(this._editor,t,!this.scrollToCursor),this.emit("record",t)),(c.Delta.guard(t)||c.CursorChange.guard(t)||c.SelectionChange.guard(t))&&this.scrollToCursor&&this._editor.renderer.scrollCursorIntoView(this._editor.session.selection.getCursor()))}return this.playing&&this.currentIndex===this.endIndex&&(this.playing=!1),this.currentIndex=e,t}next(e=!0){if(!this._trace)throw Error("Timer shouldn't fire when trace is empty");if(!this.playing)return;this.clearTimeout();let t=new Date().valueOf();e&&(this.syncTime=t,this._currentTime=(t-this.startTime)*this._playbackRate);let i=this.sync();i>0&&(this.timerStarted=new Date().valueOf(),this.timer=setTimeout(()=>{this.next()},i))}pause(e=!0){if(this.timerStarted&&(this._currentTime+=(new Date().valueOf()-this.timerStarted)*this.playbackRate),this.clearTimeout(),this.playing=!1,e){let e=this._editor.renderer;e.$cursorLayer.element.style.opacity=this.previousOpacity,e.$cursorLayer.setBlinking(this.wasBlinking),e.$cursorLayer.isVisible=this.wasVisible}}get duration(){return this._trace.duration/1e3}get currentTime(){return this.playing?(new Date().valueOf()-this.startTime)*this.playbackRate/1e3:this._currentTime/1e3}set currentTime(e){if(e<0||e>this.duration+.1)throw Error(`Bad timestamp: ${e}`);let t=1e3*e;this.syncTime=new Date().valueOf(),this.startTime=this.syncTime-t/this.playbackRate;let i=-1,r=Math.floor(e),s=this.traceIndex[r];if(void 0===s)throw Error(`Couldn't find index for ${r}: ${e}`);if(this.traceTimes[s].offset>t)throw Error(`Bad index value: ${s}`);for(let e=s;e<this.traceTimes.length;e++){let r=this.traceTimes[e];if(r.complete){if(r.offset>t)break;i=e}}this.currentIndex=i,this._currentTime=t}get playbackRate(){return this._playbackRate}set playbackRate(e){let t=this.playing;this.playing&&this.pause(!1),this._playbackRate=e,t&&this.play()}get editor(){return this._editor}}t.default=h;let d=(e,t,i=!0)=>{n.Complete.guard(t)?l(e.session,t,i):c.Delta.guard(t)?u(e.session,t):c.SelectionChange.guard(t)?p(e.session,t):c.CursorChange.guard(t)?f(e.session,t):c.ScrollChange.guard(t)&&m(e.renderer,t)},l=(e,t,i=!0)=>{e.getValue()!==t.value&&g(e,t.value);let{row:r,column:s}=t.cursor;e.selection.moveCursorTo(r,s);let{start:n,end:a}=t.selection;if(e.selection.setSelectionRange({start:{row:n.row,column:n.column},end:{row:a.row,column:a.column}}),i){let{top:i,left:r}=t.scroll;e.setScrollTop(i),e.setScrollLeft(r)}},u=(e,t)=>e.getDocument().applyDelta(t),p=(e,t)=>e.selection.setSelectionRange(t),f=(e,t)=>e.selection.moveCursorTo(t.location.row,t.location.column),m=(e,t)=>{e.scrollToY(t.top),e.scrollToX(t.left)},g=(e,t)=>{let i=e.selection.toJSON();e.setValue(t),e.selection.fromJSON(i)}},1707:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(s,n){function a(e){try{c(r.next(e))}catch(e){n(e)}}function o(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=s(i(1339)),a=s(i(2136)),o=s(i(9974));class c extends a.default{constructor(e,t){var i;super(null!==(i=null==t?void 0:t.replayEditor)&&void 0!==i?i:e,{filterRecord:null==t?void 0:t.filterRecord}),this._state="paused",this.emitter=new n.default,this.stopping=!1,this.hasRecording=!1,this.recorder=new o.default(e)}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",e))}get state(){return this._state}play(){let e=Object.create(null,{play:{get:()=>super.play}});return r(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");yield e.play.call(this),this.state="playing"})}pause(){if("playing"!==this.state)throw Error("Not playing");super.pause(),this.state="paused"}record(){return r(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");this.recorder.start(),this.state="recording"})}stop(){return r(this,void 0,void 0,function*(){if("recording"!==this.state)throw Error("Not recording");this.recorder.stop(),this.stopping=!0,this.src=this.recorder.src,this.state="paused",this.stopping=!1,this.hasRecording=!0})}addStateListener(e){this.emitter.addListener("state",e)}addEventListener(e){this.emitter.addListener("event",e)}get percent(){return this.currentTime/this.duration*100}set percent(e){this.currentTime=this.duration*e/100}set src(e){if(!this.stopping&&("playing"===this.state||"recording"===this.state))throw Error("Can't change src while playing or recording");super.src=e,this.state="paused",this.hasRecording=!1}get src(){if("recording"===this.state)throw Error("Still recording");return super.src}}t.default=c},9974:function(e,t,i){var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var s=Object.getOwnPropertyDescriptor(t,i);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,s)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&r(t,e,i);return s(t,e),t},a=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(s,n){function a(e){try{c(r.next(e))}catch(e){n(e)}}function o(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let c=i(8741),h=o(i(8817)),d=o(i(1339)),l=n(i(8494));class u extends d.default{constructor(e,t){super(),this.recording=!1,this.records=[],this.sessionMap={},this.startSession="",this.sessionInfo=[],this.editor=e,this.streamer=new l.default(e),this.options=t}start(){var e;return a(this,void 0,void 0,function*(){let t=(null===(e=this.options)||void 0===e?void 0:e.completeInterval)||1e3;if(this.records=[],this.src=void 0,0===Object.keys(this.sessionMap).length&&void 0===this.sessionName)this.sessionMap[""]={session:this.editor.getSession(),mode:this.editor.getSession().$modeId},this.sessionName="";else if(0===Object.keys(this.sessionMap).length||void 0===this.sessionName)throw Error(`Session information not properly configured: ${this.sessionName}`);this.sessionInfo=Object.entries(this.sessionMap).map(([e,t])=>({name:e,contents:t.session.getValue(),mode:t.mode})),this.startSession=this.sessionName||"",this.streamer.start(e=>{this.records.push(e),this.emit("record",e)}),this.timer=setInterval(()=>{this.addCompleteRecord("timer")},t),this.recording=!0})}stop(){return a(this,void 0,void 0,function*(){if(!this.recording)throw Error("Not recording");this.timer&&clearInterval(this.timer),this.streamer.stop(),this.src=new c.AceTrace([...this.records],this.sessionInfo,this.startSession)})}addExternalChange(e){if(!this.recording)throw Error("Not recording");if(void 0!==e.type)throw Error("type property in external changes is overwritten");let t=c.ExternalChange.check(Object.assign(Object.assign({},e),{type:"external",timestamp:new Date}));this.records.push(t),this.emit("record",t)}addCompleteRecord(e="manual"){if(!this.recording)throw Error("Not recording");let t=(0,l.getComplete)(this.editor,e,this.sessionName);this.records.push(t),this.emit("record",t)}addSession(e){let{name:t,contents:i,mode:r}=e;if(this.sessionMap[t])throw Error(`Session ${t} already exists`);this.sessionMap[t]={session:h.default.createEditSession(i,r),mode:r}}addSessions(e){for(let t of e)this.addSession(t)}setSession(e){if(!this.sessionMap[e])throw Error(`Session ${e} does not exist`);this.sessionName=this.streamer.sessionName=e,this.editor.setSession(this.sessionMap[e].session)}singleSession(e){if(Object.keys(this.sessionMap).length>0)throw Error("Session map must be empty when calling singleSession");this.addSession(e),this.sessionName=e.name}}t.default=u},8494:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getComplete=void 0;let r=i(8741),s=i(2691),n=i(9155);t.default=class{constructor(e){this._stop=()=>{},this.running=!1,this.editor=e}start(e){let i=!1,n=this.editor.renderer,{width:h,height:d}=n.$size,l=r.WindowSize.check({width:h,height:d,rows:0===d?0:this.editor.renderer.getScrollBottomRow()-this.editor.renderer.getScrollTopRow()+1,fontSize:parseInt(this.editor.getFontSize()),lineHeight:n.$textLayer.getLineHeight()}),u=(0,s.throttle)(100,()=>{if(!this.running)return;i=!1;let{width:t,height:s}=n.$size,a=r.WindowSize.check({width:t,height:s,rows:0===s?0:this.editor.renderer.getScrollBottomRow()-this.editor.renderer.getScrollTopRow()+1,fontSize:parseInt(this.editor.getFontSize()),lineHeight:n.$textLayer.getLineHeight()});(a.width!==l.width||a.height!==l.height||a.rows!==l.rows||a.fontSize!==l.fontSize||a.lineHeight!==l.lineHeight)&&(h=t,d=s,l=a,e(r.WindowSizeChange.check(Object.assign({type:"windowsizechange",timestamp:new Date,focused:this.editor.isFocused()},a))))}),p=this.editor.getValue(),f=t=>{this.running&&(i=!1,this.editor.getValue()!==p&&(p=this.editor.getValue(),e(r.Delta.check(Object.assign({type:"delta",timestamp:new Date,focused:this.editor.isFocused()},t)))))},m=r.Selection.check(this.editor.selection.getRange()),g=(0,s.throttle)(100,()=>{if(!this.running)return;i=!1;let t=r.Selection.check(this.editor.selection.getRange());if(o(t,m)||c(t)){m=t;return}m=t,e(r.SelectionChange.check(Object.assign({type:"selectionchange",timestamp:new Date,focused:this.editor.isFocused()},t)))}),y=r.EditorLocation.check(this.editor.selection.getCursor()),_=(0,s.throttle)(100,()=>{if(!this.running)return;i=!1;let t=r.EditorLocation.check(this.editor.selection.getCursor());if(a(t,y)||!c(this.editor.selection.getRange())){y=t;return}y=t,e(r.CursorChange.check({type:"cursorchange",timestamp:new Date,focused:this.editor.isFocused(),location:t}))}),v=r.ScrollPosition.check({top:this.editor.renderer.getScrollTop(),left:this.editor.renderer.getScrollLeft()}),w=(0,s.throttle)(100,()=>{if(!this.running)return;let t=i;i=!1;let s=this.editor.renderer.getScrollTop();s<0&&(s=0),s>d&&(s=d);let n=this.editor.renderer.getScrollLeft();n<0&&(n=0),n>h&&(n=h);let a=r.ScrollPosition.check({top:s,left:n});(a.top!==v.top||a.left!==v.left)&&(v=a,e(r.ScrollChange.check(Object.assign({type:"scrollchange",timestamp:new Date,focused:this.editor.isFocused(),triggeredByCursorChange:t},a))))}),b=({session:r,oldSession:s})=>{if(i=!1,s.removeEventListener("change",f),s.removeEventListener("changeScrollTop",w),s.removeEventListener("changeScrollTop",u),!this.sessionName)throw Error("Must set sessionName if switching sessions during recording");e((0,t.getComplete)(this.editor,"session",this.sessionName)),r.addEventListener("change",f),r.addEventListener("changeScrollTop",w),r.addEventListener("changeScrollTop",u)},R=()=>{i=!0};e((0,t.getComplete)(this.editor,"start",this.sessionName)),this.editor.session.addEventListener("change",f),this.editor.addEventListener("changeSelection",g),this.editor.addEventListener("changeSelection",_),this.editor.session.addEventListener("changeScrollTop",w),this.editor.renderer.addEventListener("resize",u),this.editor.addEventListener("changeSession",b),this.editor.addEventListener("beforeEndOperation",R),this.running=!0,this._stop=()=>{this.editor.removeEventListener("beforeEndOperation",R),this.editor.removeEventListener("changeSession",b),this.editor.session.removeEventListener("resize",u),this.editor.session.removeEventListener("changeScrollTop",w),this.editor.removeEventListener("changeSelection",_),this.editor.removeEventListener("changeSelection",g),this.editor.session.removeEventListener("change",f),e((0,t.getComplete)(this.editor,"end",this.sessionName)),this.running=!1}}stop(){if(!this.running)throw Error("Not running");this._stop(),this._stop=()=>{}}};let a=(e,t)=>e.column===t.column&&e.row===t.row,o=(e,t)=>a(e.start,t.start)&&a(e.end,t.end);t.getComplete=(e,t,i)=>{let r=e.renderer,{width:s,height:a}=r.$size;return n.Complete.check(Object.assign({type:"complete",timestamp:new Date,focused:e.isFocused(),value:e.session.getValue(),selection:e.session.selection.getRange(),cursor:e.session.selection.getCursor(),scroll:{top:e.renderer.getScrollTop(),left:e.renderer.getScrollLeft()},window:{width:s,height:a,rows:0===a?0:e.renderer.getScrollBottomRow()-e.renderer.getScrollTopRow()+1,fontSize:parseInt(e.getFontSize()),lineHeight:r.$textLayer.getLineHeight()},reason:t},i&&{sessionName:i}))};let c=e=>e.start.column===e.end.column&&e.start.row===e.end.row},6624:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(s,n){function a(e){try{c(r.next(e))}catch(e){n(e)}}function o(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=s(i(1339)),a=s(i(3285));t.default=class{constructor(){this.recorder=new a.default,this._state="paused",this.emitter=new n.default,this.stopping=!1,this._playbackRate=1,this.hasRecording=!1,this.player=new Audio,this.player.addEventListener("ended",()=>{this.emitter.emit("ended"),this.state="paused"})}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",e))}get state(){return this._state}play(){return r(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");this.player.playbackRate=this._playbackRate,yield this.player.play(),this.state="playing"})}pause(){if("playing"!==this.state)throw Error("Not playing");this.player.pause(),this.state="paused"}record(){return r(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");yield this.recorder.start(),this.state="recording"})}stop(){return r(this,void 0,void 0,function*(){if("recording"!==this.state)throw Error("Not recording");yield this.recorder.stop(),this.stopping=!0,this.src=this.recorder.src,this.state="paused",this.stopping=!1,this.hasRecording=!0})}set src(e){if(!this.stopping&&("playing"===this.state||"recording"===this.state))throw Error("Can't change src while playing or recording");this.player.src=e,this.player.playbackRate=this.playbackRate,""!==e&&this.player.load(),this.state="paused",this.hasRecording=!1}get src(){if("recording"===this.state)throw Error("Still recording");return this.player.src}addStateListener(e){this.emitter.addListener("state",e)}addEventListener(e){this.emitter.addListener("event",e)}get currentTime(){return this.player.currentTime}set currentTime(e){this.player.currentTime=e}get percent(){return this.player.currentTime/this.player.duration*100}set percent(e){this.player.currentTime=this.player.duration*e/100}get playbackRate(){return this.player.playbackRate}set playbackRate(e){this._playbackRate=e,this.player.playbackRate=e}get duration(){return this.player.duration}}},3285:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(s,n){function a(e){try{c(r.next(e))}catch(e){n(e)}}function o(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((r=r.apply(e,t||[])).next())})},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=s(i(1012)),a=s(i(5149));t.default=class{constructor(){this.started=0,this.chunks=[]}start(){return r(this,void 0,void 0,function*(){return this.recorder=new MediaRecorder((yield navigator.mediaDevices.getUserMedia({audio:!0}))),this.listener=({data:e})=>{e&&e.size>0&&this.chunks.push(e)},this.recorder.addEventListener("dataavailable",this.listener),this.blob=void 0,new Promise((e,t)=>{this.blob=void 0,this.recorder.addEventListener("start",()=>{this.chunks=[],this.started=Date.now(),e()},{once:!0}),this.recorder.addEventListener("error",t,{once:!0}),this.recorder.start(1e3)})})}stop(){return r(this,void 0,void 0,function*(){return new Promise(e=>{this.recorder.addEventListener("stop",()=>r(this,void 0,void 0,function*(){let t=Date.now()-this.started;this.recorder.removeEventListener("dataavailable",this.listener),this.recorder.stream.getTracks()[0].stop(),this.blob=new Blob(this.chunks,{type:this.recorder.mimeType});let i=new a.default(this.recorder.mimeType);"webm"===i.subtype&&(this.blob=yield(0,n.default)(new Blob(this.chunks,{type:this.recorder.mimeType}),t,{logger:!1})),e()}),{once:!0}),this.recorder.stop()})})}get src(){return this.blob&&URL.createObjectURL(this.blob)}}},9155:function(e,t,i){var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var s=Object.getOwnPropertyDescriptor(t,i);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,s)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),s=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)},n=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(s,n){function a(e){try{c(r.next(e))}catch(e){n(e)}}function o(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(a,o)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.urlToBase64=t.MultiRecordReplayer=t.AudioRecordReplayer=t.AudioRecorder=t.AceMultiRecordReplayer=t.AceRecordReplayer=t.AceRecorder=t.AcePlayer=t.AceStreamer=void 0;let o=a(i(8494));t.AceStreamer=o.default;let c=a(i(2136));t.AcePlayer=c.default;let h=a(i(9974));t.AceRecorder=h.default;let d=a(i(1707));t.AceRecordReplayer=d.default;let l=a(i(1257));t.AceMultiRecordReplayer=l.default;let u=a(i(3285));t.AudioRecorder=u.default;let p=a(i(6624));t.AudioRecordReplayer=p.default;let f=a(i(6151)),m=a(i(8555));t.MultiRecordReplayer=m.default,s(i(8741),t),t.default=f.default,t.urlToBase64=e=>n(void 0,void 0,void 0,function*(){let t=yield fetch(e).then(e=>e.blob());return new Promise(e=>{let i=new FileReader;i.onloadend=()=>e(i.result.toString().split(",")[1]),i.readAsDataURL(t)})})},4281:function(e,t,i){var r=i(4246),s=i(2329);t.Z=e=>(0,r.jsx)(s.ZP,{mode:"java",theme:"github",width:"100%",minLines:4,maxLines:4,showPrintMargin:!1,onBeforeLoad:e=>{e.config.set("basePath","https://cdn.jsdelivr.net/npm/ace-builds@".concat(e.version,"/src-min-noconflict"))},...e})},7529:function(e,t,i){var r=i(4246),s=i(7378);t.Z=e=>{let{recordReplayer:t}=e,[i,n]=(0,s.useState)(!1),[a,o]=(0,s.useState)("paused");(0,s.useEffect)(()=>{t.addStateListener(e=>o(e)),t.addEventListener(e=>{"ended"===e&&h(100)})},[t]);let[c,h]=(0,s.useState)(0),d=(0,s.useCallback)(e=>{t.percent=e.target.value,h(e.target.value)},[t]),l=(0,s.useRef)();(0,s.useEffect)(()=>{"playing"===a?l.current=setInterval(()=>{h(t.percent)},100):l.current&&clearInterval(l.current)},[a,t]);let[u,p]=(0,s.useState)("1.0");return(0,s.useEffect)(()=>{t.playbackRate=parseFloat(u)},[u,t]),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{style:{display:"flex",width:"100%",flexDirection:"row",alignItems:"center"},children:[(0,r.jsx)("button",{onClick:()=>{"paused"===a?t.play():"recording"===a?t.stop():t.pause()},children:"paused"===a?(0,r.jsx)(r.Fragment,{children:"Play"}):"recording"===a?(0,r.jsx)(r.Fragment,{children:"Stop"}):(0,r.jsx)(r.Fragment,{children:"Pause"})}),(0,r.jsx)("button",{disabled:"paused"!==a,onClick:()=>{t.record()},children:"Record"}),(0,r.jsxs)("select",{id:"playbackRate",onChange:e=>p(e.target.value),value:u.toString(),children:[(0,r.jsx)("option",{value:"0.5",children:"0.5"}),(0,r.jsx)("option",{value:"1.0",children:"1.0"}),(0,r.jsx)("option",{value:"2.0",children:"2.0"})]})]}),(0,r.jsx)("input",{disabled:"recording"===a,type:"range",min:"0",max:"100",step:"1",onChange:d,onMouseDown:()=>{"playing"!==a||i||(n(!0),t.pause())},onMouseUp:()=>{i&&t.play(),n(!1)},value:c,style:{width:"100%"}})]})}},8741:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeAceRecordTimestamp=t.AceTrace=t.AceTraceContent=t.AceRecord=t.ExternalChange=t.SessionInfo=t.WindowSizeChange=t.WindowSize=t.ScrollChange=t.ScrollPosition=t.CursorChange=t.SelectionChange=t.Selection=t.Delta=t.Complete=t.EditorLocation=t.AceTimestamp=void 0;let r=i(4690);t.AceTimestamp=(0,r.Union)((0,r.InstanceOf)(Date),r.String.withConstraint(e=>!isNaN(Date.parse(e).valueOf()))),t.EditorLocation=(0,r.Record)({row:r.Number,column:r.Number}),t.Complete=(0,r.Record)({type:(0,r.Literal)("complete"),timestamp:t.AceTimestamp,focused:r.Boolean,value:r.String,selection:(0,r.Record)({start:t.EditorLocation,end:t.EditorLocation}),cursor:t.EditorLocation,scroll:(0,r.Record)({top:r.Number,left:r.Number}),window:(0,r.Record)({width:r.Number,height:r.Number,rows:r.Number,fontSize:r.Number,lineHeight:r.Number}),reason:(0,r.Union)((0,r.Literal)("start"),(0,r.Literal)("timer"),(0,r.Literal)("end"),(0,r.Literal)("manual"),(0,r.Literal)("session"))}).And((0,r.Partial)({sessionName:r.String})),t.Delta=(0,r.Record)({type:(0,r.Literal)("delta"),timestamp:t.AceTimestamp,focused:r.Boolean,start:t.EditorLocation,end:t.EditorLocation,action:(0,r.Union)((0,r.Literal)("insert"),(0,r.Literal)("remove")),lines:(0,r.Array)(r.String)}).And((0,r.Partial)({id:r.Number})),t.Selection=(0,r.Record)({start:t.EditorLocation,end:t.EditorLocation}),t.SelectionChange=(0,r.Record)({type:(0,r.Literal)("selectionchange"),timestamp:t.AceTimestamp,focused:r.Boolean,start:t.EditorLocation,end:t.EditorLocation}),t.CursorChange=(0,r.Record)({type:(0,r.Literal)("cursorchange"),timestamp:t.AceTimestamp,focused:r.Boolean,location:t.EditorLocation}),t.ScrollPosition=(0,r.Record)({top:r.Number,left:r.Number}),t.ScrollChange=(0,r.Record)({type:(0,r.Literal)("scrollchange"),timestamp:t.AceTimestamp,focused:r.Boolean,top:r.Number,left:r.Number}).And((0,r.Partial)({triggeredByCursorChange:r.Boolean})),t.WindowSize=(0,r.Record)({width:r.Number,height:r.Number,rows:r.Number,fontSize:r.Number,lineHeight:r.Number}),t.WindowSizeChange=(0,r.Record)({type:(0,r.Literal)("windowsizechange"),timestamp:t.AceTimestamp,focused:r.Boolean,rows:r.Number}),t.SessionInfo=(0,r.Record)({name:r.String,contents:r.String,mode:r.String}),t.ExternalChange=(0,r.Record)({type:(0,r.Literal)("external"),timestamp:t.AceTimestamp}),t.AceRecord=(0,r.Union)(t.Complete,t.Delta,t.SelectionChange,t.CursorChange,t.ScrollChange,t.WindowSizeChange,t.ExternalChange),t.AceTraceContent=(0,r.Record)({records:(0,r.Array)(t.AceRecord),duration:r.Number,startTime:t.AceTimestamp,sessionInfo:(0,r.Array)(t.SessionInfo)}).And((0,r.Partial)({sessionName:r.String})),t.AceTrace=class{constructor(e,i,r){if(0===e.length)throw Error("Empty trace");if(this.records=e,this.startTime=new Date(e[0].timestamp),this.duration=new Date(e.slice(-1)[0].timestamp).valueOf()-new Date(e[0].timestamp).valueOf(),i.length>1&&i.find(({name:e})=>!e))throw Error("Session names must not be blank");if(!i.find(({name:e})=>e===r))throw Error("Must set sessionName when trace includes multiple sessions");this.sessionInfo=i,this.sessionName=r,t.AceTraceContent.check(this)}},t.deserializeAceRecordTimestamp=e=>(e.timestamp=new Date(e.timestamp),e)}}]);