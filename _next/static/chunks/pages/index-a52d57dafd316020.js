(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{6792:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(t){i(t)}}function c(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}l((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.recordreplayer=t.safeChangeValue=t.replay=t.record=t.stream=t.deserializeAceRecordTimestamp=t.applyAceRecord=t.AceRecord=t.ExternalChange=t.WindowSizeChange=t.WindowSize=t.applyScrollChange=t.ScrollChange=t.ScrollPosition=t.applyCursorChange=t.CursorChange=t.applySelectionChange=t.SelectionChange=t.selectionIsEmpty=t.compareSelections=t.Selection=t.applyDelta=t.Delta=t.applyComplete=t.getComplete=t.Complete=t.compareEditorLocations=t.EditorLocation=t.AceTimestamp=void 0;const i=r(n(8709)),a=n(4690),c=n(2691);t.AceTimestamp=(0,a.Union)((0,a.InstanceOf)(Date),a.String.withConstraint((e=>!isNaN(Date.parse(e).valueOf())))),t.EditorLocation=(0,a.Record)({row:a.Number,column:a.Number});t.compareEditorLocations=(e,t)=>e.column===t.column&&e.row===t.row,t.Complete=(0,a.Record)({type:(0,a.Literal)("complete"),timestamp:t.AceTimestamp,focused:a.Boolean,value:a.String,selection:(0,a.Record)({start:t.EditorLocation,end:t.EditorLocation}),cursor:t.EditorLocation,scroll:(0,a.Record)({top:a.Number,left:a.Number})});t.getComplete=e=>t.Complete.check({type:"complete",timestamp:new Date,focused:e.isFocused(),value:e.getValue(),selection:e.selection.getRange(),cursor:e.selection.getCursor(),scroll:{top:e.renderer.getScrollTop(),left:e.renderer.getScrollLeft()}});t.applyComplete=(e,n,o=!1)=>{if(e.getValue()!==n.value&&(0,t.safeChangeValue)(e,n.value),o)return;const{row:r,column:i}=n.cursor;e.selection.moveCursorTo(r,i);const{start:a,end:c}=n.selection;e.selection.setSelectionRange({start:{row:a.row,column:a.column},end:{row:c.row,column:c.column}});const{top:l,left:s}=n.scroll;e.renderer.scrollToY(l),e.renderer.scrollToX(s)},t.Delta=(0,a.Record)({type:(0,a.Literal)("delta"),timestamp:t.AceTimestamp,focused:a.Boolean,start:t.EditorLocation,end:t.EditorLocation,action:(0,a.Union)((0,a.Literal)("insert"),(0,a.Literal)("remove")),lines:(0,a.Array)(a.String)}).And((0,a.Partial)({id:a.Number}));t.applyDelta=(e,t)=>e.session.getDocument().applyDelta(t),t.Selection=(0,a.Record)({start:t.EditorLocation,end:t.EditorLocation});t.compareSelections=(e,n)=>(0,t.compareEditorLocations)(e.start,n.start)&&(0,t.compareEditorLocations)(e.end,n.end);t.selectionIsEmpty=e=>e.start.column===e.end.column&&e.start.row===e.end.row,t.SelectionChange=(0,a.Record)({type:(0,a.Literal)("selectionchange"),timestamp:t.AceTimestamp,focused:a.Boolean,start:t.EditorLocation,end:t.EditorLocation});t.applySelectionChange=(e,t)=>e.selection.setSelectionRange(t),t.CursorChange=(0,a.Record)({type:(0,a.Literal)("cursorchange"),timestamp:t.AceTimestamp,focused:a.Boolean,location:t.EditorLocation});t.applyCursorChange=(e,t)=>e.selection.moveCursorTo(t.location.row,t.location.column),t.ScrollPosition=(0,a.Record)({top:a.Number,left:a.Number}),t.ScrollChange=(0,a.Record)({type:(0,a.Literal)("scrollchange"),timestamp:t.AceTimestamp,focused:a.Boolean,top:a.Number,left:a.Number});t.applyScrollChange=(e,t)=>{e.renderer.scrollToY(t.top),e.renderer.scrollToX(t.left)},t.WindowSize=(0,a.Record)({top:a.Number,bottom:a.Number}),t.WindowSizeChange=(0,a.Record)({type:(0,a.Literal)("windowsizechange"),timestamp:t.AceTimestamp,focused:a.Boolean,top:a.Number,bottom:a.Number}),t.ExternalChange=(0,a.Record)({type:(0,a.Literal)("external"),timestamp:t.AceTimestamp}),t.AceRecord=(0,a.Union)(t.Complete,t.Delta,t.SelectionChange,t.CursorChange,t.ScrollChange,t.WindowSizeChange,t.ExternalChange);t.applyAceRecord=(e,n)=>{t.Complete.guard(n)?(0,t.applyComplete)(e,n):t.Delta.guard(n)?(0,t.applyDelta)(e,n):t.SelectionChange.guard(n)?(0,t.applySelectionChange)(e,n):t.CursorChange.guard(n)?(0,t.applyCursorChange)(e,n):t.ScrollChange.guard(n)&&(0,t.applyScrollChange)(e,n)};t.deserializeAceRecordTimestamp=e=>(e.timestamp=new Date(e.timestamp),e);t.stream=(e,n)=>{let o=!0,r=e.getValue();const i=i=>{o&&e.getValue()!==r&&(r=e.getValue(),n(t.Delta.check(Object.assign({type:"delta",timestamp:new Date,focused:e.isFocused()},i))))};let a=t.Selection.check(e.selection.getRange());const l=(0,c.throttle)(100,(()=>{if(!o)return;const r=t.Selection.check(e.selection.getRange());(0,t.compareSelections)(r,a)||(0,t.selectionIsEmpty)(r)?a=r:(a=r,n(t.SelectionChange.check(Object.assign({type:"selectionchange",timestamp:new Date,focused:e.isFocused()},r))))}));let s=t.EditorLocation.check(e.selection.getCursor());const d=(0,c.throttle)(100,(()=>{if(!o)return;const r=t.EditorLocation.check(e.selection.getCursor());!(0,t.compareEditorLocations)(r,s)&&(0,t.selectionIsEmpty)(e.selection.getRange())?(s=r,n(t.CursorChange.check({type:"cursorchange",timestamp:new Date,focused:e.isFocused(),location:r}))):s=r}));let u=t.ScrollPosition.check({top:e.renderer.getScrollTop(),left:e.renderer.getScrollLeft()});const p=(0,c.throttle)(100,(()=>{if(!o)return;const r=t.ScrollPosition.check({top:e.renderer.getScrollTop(),left:e.renderer.getScrollLeft()});r.top===u.top&&r.left===u.left||(u=r,n(t.ScrollChange.check(Object.assign({type:"scrollchange",timestamp:new Date,focused:e.isFocused()},r))))}));let m=t.WindowSize.check({top:e.renderer.getScrollTopRow(),bottom:e.renderer.getScrollBottomRow()});const h=(0,c.throttle)(100,(()=>{if(!o)return;const r=t.WindowSize.check({top:e.renderer.getScrollTopRow(),bottom:e.renderer.getScrollBottomRow()});r.top===m.top&&r.bottom===m.bottom||(m=r,n(t.WindowSizeChange.check(Object.assign({type:"windowsizechange",timestamp:new Date,focused:e.isFocused()},r))))}));let g;e.session.addEventListener("change",i),e.addEventListener("changeSelection",l),e.addEventListener("changeSelection",d),e.session.addEventListener("changeScrollTop",p),e.session.addEventListener("changeScrollTop",h);return{stop:()=>{clearTimeout(g),e.session.removeEventListener("change",i),e.removeEventListener("changeSelection",l),e.removeEventListener("changeSelection",d),e.session.removeEventListener("changeScrollTop",p)},pause:()=>{clearTimeout(g),o=!1},restart:()=>{g=setTimeout((()=>{o=!0}),200)}}};t.record=(e,n={interval:1e3})=>{const o=n.interval||1e3,r=[(0,t.getComplete)(e)],{stop:i}=(0,t.stream)(e,(e=>r.push(e))),a=setInterval((()=>r.push((0,t.getComplete)(e))),o);return{stop:()=>(clearInterval(a),i(),r.push((0,t.getComplete)(e)),r),addExternalChange:e=>{r.push(t.ExternalChange.check(Object.assign(Object.assign({},e),{type:"external",timestamp:new Date})))}}};const l=e=>new Promise((t=>setTimeout(t,e)));t.replay=(e,n,r={start:0,seek:!1},i)=>{const a={};let c,s=!1;return a.promise=new Promise((e=>{c=e})),Promise.resolve().then((()=>o(this,void 0,void 0,(function*(){const o=r.start||0,a=e.renderer,d=a.$cursorLayer.isVisible;a.$cursorLayer.isVisible=!0;const u=a.$cursorLayer.isBlinking;a.$cursorLayer.setBlinking(!0);const p=a.$cursorLayer.element.style.opacity;a.$cursorLayer.element.style.opacity=1;const m=(new Date).valueOf(),h=new Date(n[0].timestamp).valueOf();let g=0;if(o>0){let e=0;for(;e<n.length;e++){const r=n[e];new Date(r.timestamp).valueOf()-h<o&&t.Complete.guard(r)&&(g=e)}}if(r.seek)return(0,t.applyAceRecord)(e,n[g]),c();for(let c=g;c<n.length&&!s;c++){const a=n[c];if(null===i||void 0===i||i.emit("timestamp",a.timestamp),t.ExternalChange.guard(a)&&r.onExternalChange?r.onExternalChange(a):(0,t.applyAceRecord)(e,a),n[c+1]){const e=m+(new Date(n[c+1].timestamp).valueOf()-(h+o))-(new Date).valueOf();e>0&&(yield l(e))}}a.$cursorLayer.element.style.opacity=p,a.$cursorLayer.setBlinking(u),a.$cursorLayer.isVisible=d,c()})))),a.stop=()=>{s=!0},a};t.safeChangeValue=(e,t)=>{const n=e.session.selection.toJSON();e.setValue(t),e.session.selection.fromJSON(n)};t.recordreplayer=e=>{let n,o,r,a;const c=(0,i.default)(),l=e=>{r=e,c.emit("state",r)};l("blank");const s=()=>{if(!a)throw new Error("Replayer was not started");a.stop(),a=void 0,l("recorded")};return{startRecording:n=>{if(o)throw new Error("Recorder is still running");o=(0,t.record)(e,n),l("recording")},stopRecording:()=>{if(!o)throw new Error("Recorder was not started");n=o.stop(),o=void 0,l("recorded"),c.emit("content",n)},startPlaying:o=>{if(!n)throw new Error("Recording not available");if(a)throw new Error("Replayer is still running");a=(0,t.replay)(e,n,o,c),a.promise.then((()=>s())),l("playing")},stopPlaying:s,clear:()=>{a&&a.stop(),a=void 0,n=[],l("blank")},events:c,getTrace:()=>n}}},2309:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(t){i(t)}}function c(e){try{l(o.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}l((o=o.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.recordreplayer=t.urlToBase64=t.record=void 0;const i=r(n(8709)),a=n(5312),c=function(e){return o(this,void 0,void 0,(function*(){const t=new a.Decoder,n=new a.Reader;n.logging=!1,n.drop_default_duration=!1;const o=yield function(e){return new Promise(((t,n)=>{const o=new FileReader;o.readAsArrayBuffer(e),o.onloadend=()=>{t(o.result)},o.onerror=e=>{n(e)}}))}(e);t.decode(o).forEach((e=>{n.read(e)})),n.stop();const r=a.tools.makeMetadataSeekable(n.metadatas,n.duration,n.cues),i=o.slice(n.metadataSize);return new Blob([r,i],{type:e.type})}))};t.record=()=>o(this,void 0,void 0,(function*(){const e=new MediaRecorder(yield navigator.mediaDevices.getUserMedia({audio:!0}));let t=!0;const n=[];let r;const i=new Promise((e=>{r=e}));e.addEventListener("dataavailable",(({data:e})=>o(this,void 0,void 0,(function*(){const o=yield c(e);n.push(o),t||r(window.URL.createObjectURL(new Blob(n)))})))),e.start();return{stop:()=>o(this,void 0,void 0,(function*(){if(t&&"inactive"!==e.state)return t=!1,e.stop(),e.stream.getTracks()[0].stop(),i}))}}));t.urlToBase64=e=>o(this,void 0,void 0,(function*(){const t=yield fetch(e).then((e=>e.blob()));return new Promise(((e,n)=>{const o=new FileReader;o.onloadend=()=>{var t;return e(null===(t=o.result)||void 0===t?void 0:t.toString())},o.readAsDataURL(t)}))}));t.recordreplayer=()=>{let e,n,r,a;const c=(0,i.default)(),l=e=>{r=e,c.emit("state",r)};l("blank");const s=()=>{if(!a)throw new Error("Replayer was not started");a.pause(),a=void 0,l("recorded")};return{startRecording:()=>o(this,void 0,void 0,(function*(){if(n)throw new Error("Recorder is still running");n=yield(0,t.record)(),l("recording")})),stopRecording:()=>o(this,void 0,void 0,(function*(){if(!n)throw new Error("Recorder was not started");e=yield n.stop(),n=void 0,l("recorded"),c.emit("content",e)})),startPlaying:()=>{if(!e)throw new Error("Recording not available");if(a)throw new Error("Replayer is still running");a=new Audio(e),a.play(),a.addEventListener("ended",(()=>{s()})),l("playing")},stopPlaying:s,clear:()=>{a&&a.pause(),a=void 0,e=void 0,l("blank")},events:c,getAudio:()=>o(this,void 0,void 0,(function*(){return e?(0,t.urlToBase64)(e):void 0}))}}},4423:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(6440)}])},6440:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var o=n(5156),r=n.n(o),i=n(4246),a=n(6792),c=n(2309),l=n(5218),s=n(7378),d=n(7118),u=n.n(d);function p(e,t,n,o,r,i,a){try{var c=e[i](a),l=c.value}catch(s){return void n(s)}c.done?t(l):Promise.resolve(l).then(o,r)}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){m(e,t,n[t])}))}return e}function g(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var f=(0,l.default)((function(){return Promise.all([n.e(774),n.e(90),n.e(329)]).then(n.bind(n,2329))}),{loadableGenerated:{webpack:function(){return[2329]},modules:["index.tsx -> react-ace"]},ssr:!1}),v=function(e){var t,n=e.acereplayer,o=e.audioreplayer,a=(0,s.useState)("blank"),c=a[0],l=a[1];return(0,s.useEffect)((function(){null===n||void 0===n||n.events.on("state",(function(e){return l(e)})),null===o||void 0===o||o.events.on("state",(function(e){return l(e)}))}),[]),(0,i.jsxs)("div",{style:{display:"flex",width:"100%",flexDirection:"row",alignItems:"center"},children:[(0,i.jsx)("button",{disabled:"blank"===c||"playing"===c||"recording"===c,onClick:function(){null===n||void 0===n||n.startPlaying(),null===o||void 0===o||o.startPlaying()},children:"Play"}),(0,i.jsx)("button",{disabled:"blank"!==c,onClick:function(){null===n||void 0===n||n.startRecording(),null===o||void 0===o||o.startRecording()},children:"Record"}),(0,i.jsx)("button",{disabled:"recording"!==c&&"playing"!==c,onClick:function(){"recording"===c?(null===n||void 0===n||n.stopRecording(),null===o||void 0===o||o.stopRecording()):(null===n||void 0===n||n.stopPlaying(),null===o||void 0===o||o.stopPlaying())},children:"Stop"}),(0,i.jsx)("button",{disabled:"blank"===c||"playing"===c||"recording"===c,onClick:function(){null===n||void 0===n||n.clear(),null===o||void 0===o||o.clear()},children:"Clear"}),(0,i.jsx)("button",{disabled:"blank"===c||"playing"===c||"recording"===c,onClick:(t=r().mark((function e(){var t,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=null===n||void 0===n?void 0:n.getTrace(),e.next=3,null===o||void 0===o?void 0:o.getAudio();case 3:i=e.sent,console.log(h({},t&&{trace:t},i&&{audio:i}));case 5:case"end":return e.stop()}}),e)})),function(){var e=this,n=arguments;return new Promise((function(o,r){var i=t.apply(e,n);function a(e){p(i,o,r,a,c,"next",e)}function c(e){p(i,o,r,a,c,"throw",e)}a(void 0)}))}),children:"Log"})]})},y=function(){var e=(0,s.useState)(void 0),t=e[0],n=e[1],o=(0,s.useRef)((0,c.recordreplayer)()),r=(0,s.useState)("blank"),l=r[0],d=r[1];return(0,s.useEffect)((function(){var e;null===(e=o.current)||void 0===e||e.events.on("state",(function(e){return d(e)}))}),[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h2",{children:"Single Editor Record and Replay Demo (With Audio)"}),(0,i.jsx)("p",{children:"Use the record button to start recording, and replay to replay when you are finished."}),t&&(0,i.jsx)(v,{acereplayer:t,audioreplayer:o.current}),(0,i.jsx)("div",{style:{display:"flex"},children:"recording"===l&&(0,i.jsx)(u(),{children:function(){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u().Minutes,{}),":",(0,i.jsx)(u().Seconds,{})]})}})}),(0,i.jsx)(f,{mode:"java",theme:"github",width:"100%",height:"16rem",minLines:16,maxLines:1/0,showPrintMargin:!1,onBeforeLoad:function(e){e.config.set("basePath","https://cdn.jsdelivr.net/npm/ace-builds@".concat(e.version,"/src-min-noconflict"))},onLoad:function(e){n((0,a.recordreplayer)(e))}})]})},w=function(){var e=(0,s.useState)([]),t=e[0],n=e[1];return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h2",{children:"Single Editor Stream Demo"}),(0,i.jsx)("p",{children:"Live edits are streamed below the editor."}),(0,i.jsx)(f,{mode:"java",theme:"github",width:"100%",height:"16rem",minLines:16,maxLines:1/0,showPrintMargin:!1,onBeforeLoad:function(e){e.config.set("basePath","https://cdn.jsdelivr.net/npm/ace-builds@".concat(e.version,"/src-min-noconflict"))},onLoad:function(e){(0,a.stream)(e,(function(e){n((function(t){return[e].concat(g(t))}))}))}}),(0,i.jsx)("button",{onClick:function(){return n([])},style:{marginTop:8},children:"Clear"}),(0,i.jsx)("div",{style:{height:"16rem",overflow:"scroll",marginTop:8},children:t.map((function(e,t){return(0,i.jsx)("pre",{children:JSON.stringify(e,null,2)},t)}))})]})};function b(){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h1",{children:(0,i.jsx)("kbd",{children:"ace-tracer"})}),(0,i.jsxs)("p",{children:["Visit the ",(0,i.jsx)("a",{href:"https://github.com/cs124-illinois/ace-tracer",children:"project homepage"})]}),(0,i.jsx)(y,{}),(0,i.jsx)(w,{})]})}}},function(e){e.O(0,[774,290,888,179],(function(){return t=4423,e(e.s=t);var t}));var t=e.O();_N_E=t}]);