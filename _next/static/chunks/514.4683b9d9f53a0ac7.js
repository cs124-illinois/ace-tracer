(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[514],{8555:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(r,n){function o(e){try{c(s.next(e))}catch(t){n(t)}}function a(e){try{c(s.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(i(1339)),o=r(i(1257)),a=r(i(6624));t.default=class{constructor(...e){this._audio=new a.default,this.emitter=new n.default,this._state="paused",this.tolerance=.1,this.hasRecording=!1,this._ace=new o.default(...e),this._audio.addStateListener((e=>{if(this._state!==e){if(this._ace.state!==e&&"paused"===e)try{this._ace.pause()}catch(t){}this.state=e}})),this.audio.player.addEventListener("ended",(()=>{this.currentTime=0,this.emitter.emit("event","ended")})),this.audio.player.addEventListener("waiting",(()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}})),this.audio.player.addEventListener("stalled",(()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}})),this.audio.player.addEventListener("playing",(()=>{if("playing"!==this._ace.state)try{this._ace.currentTime=this._audio.currentTime,this._ace.play()}catch(e){}})),this.audio.player.addEventListener("pause",(()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}})),this.audio.player.addEventListener("timeupdate",(()=>{Math.abs(this._ace.currentTime-this._audio.currentTime)>this.tolerance&&(this._ace.currentTime=this._audio.currentTime)}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",this._state))}play(){return s(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");yield this._audio.play(),this.state="playing"}))}pause(){if("playing"!==this.state)throw new Error("Not playing");this._audio.pause(),this.state="paused"}record(){return s(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");yield this._audio.record(),yield this._ace.record(),this.state="recording"}))}stop(){return s(this,void 0,void 0,(function*(){if("recording"!==this.state)throw new Error("Not recording");if(this.hasRecording=!0,yield this._audio.stop(),yield this._ace.stop(),Math.abs(this._audio.duration-this._ace.duration)>100)throw this.hasRecording=!1,new Error(`Recordings do not have equal length: Audio ${this._audio.duration} <-> Ace ${this._ace.duration}`);this.hasRecording&&this.emitter.emit("event","srcChanged"),this.state="paused"}))}addStateListener(e){this.emitter.addListener("state",e)}addEventListener(e){this.emitter.addListener("event",e)}set src(e){if("playing"===this.state||"recording"===this.state)throw new Error("Can't change source while recording or playing");this._ace.src=e?e.ace:void 0,this._audio.src=e?e.audio:"",this.hasRecording=!1,this.state="paused",this.emitter.emit("event","srcChanged")}get src(){if("recording"===this.state)throw new Error("Still recording");return this._ace.src?{ace:this._ace.src,audio:this._audio.src}:void 0}get currentTime(){return this._audio.currentTime}set currentTime(e){this._audio.currentTime=e,this._ace.currentTime=e,this._ace.sync(),this.emitter.emit("event","seeked")}get percent(){return this._audio.percent}set percent(e){this._audio.percent=e,this._ace.percent=e,this._ace.sync(),this.emitter.emit("event","seeked")}get ace(){return this._ace}get audio(){return this._audio}set playbackRate(e){this._audio.playbackRate=e,this._ace.playbackRate=e,this.emitter.emit("event","playbackRateChange")}get playbackRate(){return this._audio.playbackRate}get duration(){return this._audio.duration}}},6151:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(r,n){function o(e){try{c(s.next(e))}catch(t){n(t)}}function a(e){try{c(s.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(i(1339)),o=r(i(1707)),a=r(i(6624));t.default=class{constructor(...e){this._audio=new a.default,this.emitter=new n.default,this._state="paused",this.tolerance=.1,this.hasRecording=!1,this._ace=new o.default(...e),this._audio.addStateListener((e=>{if(this._state!==e){if(this._ace.state!==e&&"paused"===e)try{this._ace.pause()}catch(t){}this.state=e}})),this.audio.player.addEventListener("ended",(()=>{this.currentTime=0,this.emitter.emit("event","ended")})),this.audio.player.addEventListener("waiting",(()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}})),this.audio.player.addEventListener("stalled",(()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}})),this.audio.player.addEventListener("playing",(()=>{if("playing"!==this._ace.state)try{this._ace.currentTime=this._audio.currentTime,this._ace.play()}catch(e){}})),this.audio.player.addEventListener("pause",(()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}})),this.audio.player.addEventListener("timeupdate",(()=>{Math.abs(this._ace.currentTime-this._audio.currentTime)>this.tolerance&&(this._ace.currentTime=this._audio.currentTime)}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",this._state))}play(){return s(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");if(!this.src)throw new Error("No source");yield this._audio.play(),this.state="playing"}))}pause(){if("playing"!==this.state)throw new Error("Not playing");this._audio.pause(),this.state="paused"}record(){return s(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");yield this._audio.record(),yield this._ace.record(),this.state="recording"}))}stop(){return s(this,void 0,void 0,(function*(){if("recording"!==this.state)throw new Error("Not recording");if(this.hasRecording=!0,yield this._audio.stop(),yield this._ace.stop(),Math.abs(this._audio.duration-this._ace.duration)>100)throw this.hasRecording=!1,new Error(`Recordings do not have equal length: Audio ${this._audio.duration} <-> Ace ${this._ace.duration}`);this.hasRecording&&this.emitter.emit("event","srcChanged"),this.state="paused"}))}addStateListener(e){this.emitter.addListener("state",e)}addEventListener(e){this.emitter.addListener("event",e)}set src(e){if("playing"===this.state||"recording"===this.state)throw new Error("Can't change source while recording or playing");this._ace.src=e?e.ace:void 0,this._audio.src=e?e.audio:"",this.hasRecording=!1,this.state="paused",this.emitter.emit("event","srcChanged")}get src(){if("recording"===this.state)throw new Error("Still recording");return this._ace.src?{ace:this._ace.src,audio:this._audio.src}:void 0}get currentTime(){return this._audio.currentTime}set currentTime(e){this._audio.currentTime=e,this._ace.currentTime=e,this._ace.sync(),this.emitter.emit("event","seeked")}get percent(){return this._audio.percent}set percent(e){this._audio.percent=e,this._ace.percent=e,this._ace.sync(),this.emitter.emit("event","seeked")}get ace(){return this._ace}get audio(){return this._audio}set playbackRate(e){this._audio.playbackRate=e,this._ace.playbackRate=e,this.emitter.emit("event","playbackRateChange")}get playbackRate(){return this._audio.playbackRate}get duration(){return this._audio.duration}}},1257:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(r,n){function o(e){try{c(s.next(e))}catch(t){n(t)}}function a(e){try{c(s.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(i(1339)),o=r(i(2136)),a=r(i(9974));t.default=class{constructor(e,t){this.players={},this.recorders={},this._state="paused",this.emitter=new n.default,this.stopping=!1,this.hasRecording=!1;for(const i of Object.keys(e))this.players[i]=new o.default((null===t||void 0===t?void 0:t.replayEditors)?t.replayEditors[i]:e[i],{filterRecord:e=>!(null===t||void 0===t?void 0:t.filterRecord)||t.filterRecord(e,i)}),this.recorders[i]=new a.default(e[i])}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",e))}get state(){return this._state}play(){return s(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");for(const e of Object.keys(this.players))yield this.players[e].play();this.state="playing"}))}pause(){if("playing"!==this.state)throw new Error("Not playing");for(const e of Object.keys(this.players))this.players[e].pause();this.state="paused"}sync(){for(const e of Object.keys(this.players))this.players[e].sync()}record(){return s(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");for(const e of Object.keys(this.recorders))this.recorders[e].start();this.state="recording",this.hasRecording=!0}))}stop(){return s(this,void 0,void 0,(function*(){if("recording"!==this.state)throw new Error("Not recording");this.stopping=!0;const e={};for(const t of Object.keys(this.recorders))this.recorders[t].stop(),e[t]=this.recorders[t].src;this.src=e,this.state="paused",this.stopping=!1}))}addStateListener(e){this.emitter.addListener("state",e)}addEventListener(e){this.emitter.addListener("event",e)}get currentTime(){return this.players[Object.keys(this.players)[0]].currentTime}set currentTime(e){for(const t of Object.keys(this.players))this.players[t].currentTime=e}get playbackRate(){return this.players[Object.keys(this.players)[0]].playbackRate}set playbackRate(e){for(const t of Object.keys(this.players))this.players[t].playbackRate=e}get duration(){return this.players[Object.keys(this.players)[0]].duration}get percent(){return this.currentTime/this.duration*100}set percent(e){this.currentTime=this.duration*e/100}set src(e){if(!this.stopping&&("playing"===this.state||"recording"===this.state))throw new Error("Can't change src while playing or recording");if(this._src=e,e)for(const t of Object.keys(e))this.players[t].src=e[t];this.state="paused",this.hasRecording=!1}get src(){if("recording"===this.state)throw new Error("Still recording");return this._src}}},2136:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(r,n){function o(e){try{c(s.next(e))}catch(t){n(t)}}function a(e){try{c(s.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(8741),o=r(i(8817)),a=r(i(1339)),c=i(9155);class h extends a.default{constructor(e,t){super(),this._currentTime=0,this.currentIndex=0,this.endIndex=0,this.traceTimes=[],this.traceIndex={},this.playing=!1,this.scrollToCursor=!1,this.sessionMap={},this._editor=e,this.filterRecord=null===t||void 0===t?void 0:t.filterRecord;const i=this._editor.renderer;this.wasVisible=i.$cursorLayer.isVisible,this.wasBlinking=i.$cursorLayer.isBlinking,this.previousOpacity=i.$cursorLayer.element.style.opacity,this._playbackRate=1}set src(e){if(!e)return void(this._trace=e);if(this._trace=e,this.endIndex=e.records.length,this.traceTimes=this._trace.records.map(((t,i)=>{const s=n.Complete.guard(t),r=new Date(t.timestamp).valueOf()-new Date(e.startTime).valueOf(),o=Math.ceil(r/1e3);return s&&(this.traceIndex[o]=i),{complete:s,offset:r}})),this._trace.sessionName){this.sessionMap={};for(const{name:e,contents:t,mode:i}of this._trace.sessionInfo)this.sessionMap[e]=o.default.createEditSession(t,i);this._editor.setSession(this.sessionMap[this._trace.sessionName])}let t=0;for(let i=0;i<Math.floor(this.traceTimes[this.endIndex-1].offset)/1e3;i++)this.traceIndex[i]?t=i:this.traceIndex[i]=t}get src(){return this._trace}play(){return s(this,void 0,void 0,(function*(){if(!this._trace)throw new Error("No trace loaded");const e=this._editor.renderer;e.$cursorLayer.isVisible=!0,e.$cursorLayer.setBlinking(!0),e.$cursorLayer.element.style.opacity=1,this.currentTime=this._currentTime/1e3,this.syncTime=(new Date).valueOf(),this.startTime=this.syncTime-this._currentTime/this.playbackRate,this.playing=!0,this.next(!1)}))}clearTimeout(){this.timer&&(clearTimeout(this.timer),this.timer=void 0,this.timerStarted=void 0)}sync(){if(!this._trace)throw new Error("Can't sync without trace");let e,t=-1;for(e=this.currentIndex;e<this.endIndex&&(t=this.startTime+this.traceTimes[e].offset/this.playbackRate-this.syncTime,!(t>0));e++){const t=this._trace.records[e];!1!==(!this.filterRecord||this.filterRecord(t))&&(n.Complete.guard(t)&&t.sessionName&&this._editor.setSession(this.sessionMap[t.sessionName]),n.ScrollPosition.guard(t)&&this.scrollToCursor&&t.triggeredByCursorChange||(d(this._editor,t,!this.scrollToCursor),this.emit("record",t)),(c.Delta.guard(t)||c.CursorChange.guard(t)||c.SelectionChange.guard(t))&&this.scrollToCursor&&this._editor.renderer.scrollCursorIntoView(this._editor.session.selection.getCursor()))}return this.playing&&this.currentIndex===this.endIndex&&(this.playing=!1),this.currentIndex=e,t}next(e=!0){if(!this._trace)throw new Error("Timer shouldn't fire when trace is empty");if(!this.playing)return;this.clearTimeout();const t=(new Date).valueOf();e&&(this.syncTime=t,this._currentTime=(t-this.startTime)*this._playbackRate);const i=this.sync();i>0&&(this.timerStarted=(new Date).valueOf(),this.timer=setTimeout((()=>{this.next()}),i))}pause(e=!0){if(this.timerStarted&&(this._currentTime+=((new Date).valueOf()-this.timerStarted)*this.playbackRate),this.clearTimeout(),this.playing=!1,e){const e=this._editor.renderer;e.$cursorLayer.element.style.opacity=this.previousOpacity,e.$cursorLayer.setBlinking(this.wasBlinking),e.$cursorLayer.isVisible=this.wasVisible}}get duration(){return this._trace.duration/1e3}get currentTime(){return this.playing?((new Date).valueOf()-this.startTime)*this.playbackRate/1e3:this._currentTime/1e3}set currentTime(e){if(e<0||e>this.duration+.1)throw new Error(`Bad timestamp: ${e}`);const t=1e3*e;this.syncTime=(new Date).valueOf(),this.startTime=this.syncTime-t/this.playbackRate;let i=-1;const s=Math.floor(e),r=this.traceIndex[s];if(void 0===r)throw new Error(`Couldn't find index for ${s}: ${e}`);if(this.traceTimes[r].offset>t)throw new Error(`Bad index value: ${r}`);for(let n=r;n<this.traceTimes.length;n++){const e=this.traceTimes[n];if(e.complete){if(e.offset>t)break;i=n}}this.currentIndex=i,this._currentTime=t}get playbackRate(){return this._playbackRate}set playbackRate(e){const t=this.playing;this.playing&&this.pause(!1),this._playbackRate=e,t&&this.play()}get editor(){return this._editor}}t.default=h;const d=(e,t,i=!0)=>{n.Complete.guard(t)?u(e.session,t,i):c.Delta.guard(t)?l(e.session,t):c.SelectionChange.guard(t)?p(e.session,t):c.CursorChange.guard(t)?f(e.session,t):c.ScrollChange.guard(t)&&g(e.renderer,t)},u=(e,t,i=!0)=>{e.getValue()!==t.value&&m(e,t.value);const{row:s,column:r}=t.cursor;e.selection.moveCursorTo(s,r);const{start:n,end:o}=t.selection;if(e.selection.setSelectionRange({start:{row:n.row,column:n.column},end:{row:o.row,column:o.column}}),i){const{top:i,left:s}=t.scroll;e.setScrollTop(i),e.setScrollLeft(s)}},l=(e,t)=>e.getDocument().applyDelta(t),p=(e,t)=>e.selection.setSelectionRange(t),f=(e,t)=>e.selection.moveCursorTo(t.location.row,t.location.column),g=(e,t)=>{e.scrollToY(t.top),e.scrollToX(t.left)},m=(e,t)=>{const i=e.selection.toJSON();e.setValue(t),e.selection.fromJSON(i)}},1707:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(r,n){function o(e){try{c(s.next(e))}catch(t){n(t)}}function a(e){try{c(s.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(i(1339)),o=r(i(2136)),a=r(i(9974));class c extends o.default{constructor(e,t){var i;super(null!==(i=null===t||void 0===t?void 0:t.replayEditor)&&void 0!==i?i:e,{filterRecord:null===t||void 0===t?void 0:t.filterRecord}),this._state="paused",this.emitter=new n.default,this.stopping=!1,this.hasRecording=!1,this.recorder=new a.default(e)}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",e))}get state(){return this._state}play(){const e=Object.create(null,{play:{get:()=>super.play}});return s(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");yield e.play.call(this),this.state="playing"}))}pause(){if("playing"!==this.state)throw new Error("Not playing");super.pause(),this.state="paused"}record(){return s(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");this.recorder.start(),this.state="recording"}))}stop(){return s(this,void 0,void 0,(function*(){if("recording"!==this.state)throw new Error("Not recording");this.recorder.stop(),this.stopping=!0,this.src=this.recorder.src,this.state="paused",this.stopping=!1,this.hasRecording=!0}))}addStateListener(e){this.emitter.addListener("state",e)}addEventListener(e){this.emitter.addListener("event",e)}get percent(){return this.currentTime/this.duration*100}set percent(e){this.currentTime=this.duration*e/100}set src(e){if(!this.stopping&&("playing"===this.state||"recording"===this.state))throw new Error("Can't change src while playing or recording");super.src=e,this.state="paused",this.hasRecording=!1}get src(){if("recording"===this.state)throw new Error("Still recording");return super.src}}t.default=c},9974:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(r,n){function o(e){try{c(s.next(e))}catch(t){n(t)}}function a(e){try{c(s.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(8741),o=r(i(8817)),a=r(i(1339)),c=i(9155),h=r(i(8494));class d extends a.default{constructor(e,t){super(),this.recording=!1,this.records=[],this.sessionMap={},this.startSession="",this.sessionInfo=[],this.editor=e,this.streamer=new h.default(e),this.options=t}start(){var e;return s(this,void 0,void 0,(function*(){const t=(null===(e=this.options)||void 0===e?void 0:e.completeInterval)||1e3;if(this.records=[],this.src=void 0,0===Object.keys(this.sessionMap).length&&void 0===this.sessionName)this.sessionMap[""]={session:this.editor.getSession(),mode:this.editor.getSession().$modeId},this.sessionName="";else if(0===Object.keys(this.sessionMap).length||void 0===this.sessionName)throw new Error(`Session information not properly configured: ${this.sessionName}`);this.sessionInfo=Object.entries(this.sessionMap).map((([e,t])=>({name:e,contents:t.session.getValue(),mode:t.mode}))),this.startSession=this.sessionName||"",this.streamer.start((e=>{this.records.push(e),this.emit("record",e)})),this.timer=setInterval((()=>{this.addCompleteRecord("timer")}),t),this.recording=!0}))}stop(){return s(this,void 0,void 0,(function*(){if(!this.recording)throw new Error("Not recording");this.timer&&clearInterval(this.timer),this.streamer.stop(),this.src=new n.AceTrace([...this.records],this.sessionInfo,this.startSession)}))}addExternalChange(e){if(!this.recording)throw new Error("Not recording");if(void 0!==e.type)throw new Error("type property in external changes is overwritten");const t=n.ExternalChange.check(Object.assign(Object.assign({},e),{type:"external",timestamp:new Date}));this.records.push(t),this.emit("record",t)}addCompleteRecord(e="manual"){if(!this.recording)throw new Error("Not recording");const t=u(this.editor,e,this.sessionName);this.records.push(t),this.emit("record",t)}addSession(e){const{name:t,contents:i,mode:s}=e;if(this.sessionMap[t])throw new Error(`Session ${t} already exists`);this.sessionMap[t]={session:o.default.createEditSession(i,s),mode:s}}addSessions(e){for(const t of e)this.addSession(t)}setSession(e){if(!this.sessionMap[e])throw new Error(`Session ${e} does not exist`);this.sessionName=this.streamer.sessionName=e,this.editor.setSession(this.sessionMap[e].session)}singleSession(e){if(Object.keys(this.sessionMap).length>0)throw new Error("Session map must be empty when calling singleSession");this.addSession(e),this.sessionName=e.name}}const u=(e,t,i)=>{const s=e.renderer,{width:r,height:n}=s.$size;return c.Complete.check(Object.assign({type:"complete",timestamp:new Date,focused:e.isFocused(),value:e.session.getValue(),selection:e.session.selection.getRange(),cursor:e.session.selection.getCursor(),scroll:{top:e.renderer.getScrollTop(),left:e.renderer.getScrollLeft()},window:{width:r,height:n,rows:e.renderer.getScrollBottomRow()-e.renderer.getScrollTopRow()+1,fontSize:parseInt(e.getFontSize()),lineHeight:s.$textLayer.getLineHeight()},reason:t},i&&{sessionName:i}))};t.default=d},8494:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});const s=i(8741),r=i(2691),n=i(9155);t.default=class{constructor(e){this._stop=()=>{},this.running=!1,this.editor=e}start(e){let t=!1;const i=this.editor.renderer;let{width:n,height:d}=i.$size,u=s.WindowSize.check({width:n,height:d,rows:this.editor.renderer.getScrollBottomRow()-this.editor.renderer.getScrollTopRow()+1,fontSize:parseInt(this.editor.getFontSize()),lineHeight:i.$textLayer.getLineHeight()});const l=(0,r.throttle)(100,(()=>{if(!this.running)return;t=!1;const{width:r,height:o}=i.$size,a=s.WindowSize.check({width:r,height:o,rows:this.editor.renderer.getScrollBottomRow()-this.editor.renderer.getScrollTopRow()+1,fontSize:parseInt(this.editor.getFontSize()),lineHeight:i.$textLayer.getLineHeight()});a.width===u.width&&a.height===u.height&&a.rows===u.rows&&a.fontSize===u.fontSize&&a.lineHeight===u.lineHeight||(n=r,d=o,u=a,e(s.WindowSizeChange.check(Object.assign({type:"windowsizechange",timestamp:new Date,focused:this.editor.isFocused()},a))))}));let p=this.editor.getValue();const f=i=>{this.running&&(t=!1,this.editor.getValue()!==p&&(p=this.editor.getValue(),e(s.Delta.check(Object.assign({type:"delta",timestamp:new Date,focused:this.editor.isFocused()},i)))))};let g=s.Selection.check(this.editor.selection.getRange());const m=(0,r.throttle)(100,(()=>{if(!this.running)return;t=!1;const i=s.Selection.check(this.editor.selection.getRange());a(i,g)||h(i)?g=i:(g=i,e(s.SelectionChange.check(Object.assign({type:"selectionchange",timestamp:new Date,focused:this.editor.isFocused()},i))))}));let y=s.EditorLocation.check(this.editor.selection.getCursor());const w=(0,r.throttle)(100,(()=>{if(!this.running)return;t=!1;const i=s.EditorLocation.check(this.editor.selection.getCursor());!o(i,y)&&h(this.editor.selection.getRange())?(y=i,e(s.CursorChange.check({type:"cursorchange",timestamp:new Date,focused:this.editor.isFocused(),location:i}))):y=i}));let v=s.ScrollPosition.check({top:this.editor.renderer.getScrollTop(),left:this.editor.renderer.getScrollLeft()});const _=(0,r.throttle)(100,(()=>{if(!this.running)return;const i=t;t=!1;let r=this.editor.renderer.getScrollTop();r<0&&(r=0),r>d&&(r=d);let o=this.editor.renderer.getScrollLeft();o<0&&(o=0),o>n&&(o=n);const a=s.ScrollPosition.check({top:r,left:o});a.top===v.top&&a.left===v.left||(v=a,e(s.ScrollChange.check(Object.assign({type:"scrollchange",timestamp:new Date,focused:this.editor.isFocused(),triggeredByCursorChange:i},a))))})),b=({session:i,oldSession:s})=>{if(t=!1,s.removeEventListener("change",f),s.removeEventListener("changeScrollTop",_),s.removeEventListener("changeScrollTop",l),!this.sessionName)throw new Error("Must set sessionName if switching sessions during recording");e(c(this.editor,"session",this.sessionName)),i.addEventListener("change",f),i.addEventListener("changeScrollTop",_),i.addEventListener("changeScrollTop",l)},S=()=>{t=!0};e(c(this.editor,"start",this.sessionName)),this.editor.session.addEventListener("change",f),this.editor.addEventListener("changeSelection",m),this.editor.addEventListener("changeSelection",w),this.editor.session.addEventListener("changeScrollTop",_),this.editor.renderer.addEventListener("resize",l),this.editor.addEventListener("changeSession",b),this.editor.addEventListener("beforeEndOperation",S),this.running=!0,this._stop=()=>{this.editor.removeEventListener("beforeEndOperation",S),this.editor.removeEventListener("changeSession",b),this.editor.session.removeEventListener("resize",l),this.editor.session.removeEventListener("changeScrollTop",_),this.editor.removeEventListener("changeSelection",w),this.editor.removeEventListener("changeSelection",m),this.editor.session.removeEventListener("change",f),e(c(this.editor,"end",this.sessionName)),this.running=!1}}stop(){if(!this.running)throw new Error("Not running");this._stop(),this._stop=()=>{}}};const o=(e,t)=>e.column===t.column&&e.row===t.row,a=(e,t)=>o(e.start,t.start)&&o(e.end,t.end),c=(e,t,i)=>{const s=e.renderer,{width:r,height:o}=s.$size;return n.Complete.check(Object.assign({type:"complete",timestamp:new Date,focused:e.isFocused(),value:e.session.getValue(),selection:e.session.selection.getRange(),cursor:e.session.selection.getCursor(),scroll:{top:e.renderer.getScrollTop(),left:e.renderer.getScrollLeft()},window:{width:r,height:o,rows:e.renderer.getScrollBottomRow()-e.renderer.getScrollTopRow()+1,fontSize:parseInt(e.getFontSize()),lineHeight:s.$textLayer.getLineHeight()},reason:t},i&&{sessionName:i}))},h=e=>e.start.column===e.end.column&&e.start.row===e.end.row},6624:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(r,n){function o(e){try{c(s.next(e))}catch(t){n(t)}}function a(e){try{c(s.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(i(1339)),o=r(i(3285));t.default=class{constructor(){this.recorder=new o.default,this._state="paused",this.emitter=new n.default,this.stopping=!1,this._playbackRate=1,this.hasRecording=!1,this.player=new Audio,this.player.addEventListener("ended",(()=>{this.emitter.emit("ended"),this.state="paused"}))}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",e))}get state(){return this._state}play(){return s(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");this.player.playbackRate=this._playbackRate,yield this.player.play(),this.state="playing"}))}pause(){if("playing"!==this.state)throw new Error("Not playing");this.player.pause(),this.state="paused"}record(){return s(this,void 0,void 0,(function*(){if("paused"!==this.state)throw new Error("Not paused");yield this.recorder.start(),this.state="recording"}))}stop(){return s(this,void 0,void 0,(function*(){if("recording"!==this.state)throw new Error("Not recording");yield this.recorder.stop(),this.stopping=!0,this.src=this.recorder.src,this.state="paused",this.stopping=!1,this.hasRecording=!0}))}set src(e){if(!this.stopping&&("playing"===this.state||"recording"===this.state))throw new Error("Can't change src while playing or recording");this.player.src=e,this.player.playbackRate=this.playbackRate,""!==e&&this.player.load(),this.state="paused",this.hasRecording=!1}get src(){if("recording"===this.state)throw new Error("Still recording");return this.player.src}addStateListener(e){this.emitter.addListener("state",e)}addEventListener(e){this.emitter.addListener("event",e)}get currentTime(){return this.player.currentTime}set currentTime(e){this.player.currentTime=e}get percent(){return this.player.currentTime/this.player.duration*100}set percent(e){this.player.currentTime=this.player.duration*e/100}get playbackRate(){return this.player.playbackRate}set playbackRate(e){this._playbackRate=e,this.player.playbackRate=e}get duration(){return this.player.duration}}},3285:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(r,n){function o(e){try{c(s.next(e))}catch(t){n(t)}}function a(e){try{c(s.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(i(1012)),o=r(i(5149));t.default=class{constructor(){this.started=0,this.chunks=[]}start(){return s(this,void 0,void 0,(function*(){return this.recorder=new MediaRecorder(yield navigator.mediaDevices.getUserMedia({audio:!0})),this.listener=({data:e})=>{e&&e.size>0&&this.chunks.push(e)},this.recorder.addEventListener("dataavailable",this.listener),this.blob=void 0,new Promise(((e,t)=>{this.blob=void 0,this.recorder.addEventListener("start",(()=>{this.chunks=[],this.started=Date.now(),e()}),{once:!0}),this.recorder.addEventListener("error",t,{once:!0}),this.recorder.start(1e3)}))}))}stop(){return s(this,void 0,void 0,(function*(){return new Promise((e=>{this.recorder.addEventListener("stop",(()=>s(this,void 0,void 0,(function*(){const t=Date.now()-this.started;this.recorder.removeEventListener("dataavailable",this.listener),this.recorder.stream.getTracks()[0].stop(),this.blob=new Blob(this.chunks,{type:this.recorder.mimeType});"webm"===new o.default(this.recorder.mimeType).subtype&&(this.blob=yield(0,n.default)(new Blob(this.chunks,{type:this.recorder.mimeType}),t,{logger:!1})),e()}))),{once:!0}),this.recorder.stop()}))}))}get src(){return this.blob&&URL.createObjectURL(this.blob)}}},9155:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)},n=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(r,n){function o(e){try{c(s.next(e))}catch(t){n(t)}}function a(e){try{c(s.throw(e))}catch(t){n(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.urlToBase64=t.MultiRecordReplayer=t.AudioRecordReplayer=t.AudioRecorder=t.AceMultiRecordReplayer=t.AceRecordReplayer=t.AceRecorder=t.AcePlayer=t.AceStreamer=void 0;const a=o(i(8494));t.AceStreamer=a.default;const c=o(i(2136));t.AcePlayer=c.default;const h=o(i(9974));t.AceRecorder=h.default;const d=o(i(1707));t.AceRecordReplayer=d.default;const u=o(i(1257));t.AceMultiRecordReplayer=u.default;const l=o(i(3285));t.AudioRecorder=l.default;const p=o(i(6624));t.AudioRecordReplayer=p.default;const f=o(i(6151)),g=o(i(8555));t.MultiRecordReplayer=g.default,r(i(8741),t),t.default=f.default;t.urlToBase64=e=>n(this,void 0,void 0,(function*(){const t=yield fetch(e).then((e=>e.blob()));return new Promise((e=>{const i=new FileReader;i.onloadend=()=>e(i.result.toString().split(",")[1]),i.readAsDataURL(t)}))}))},2482:function(e,t,i){"use strict";var s=i(4246),r=i(2329);function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}t.Z=function(e){return(0,s.jsx)(r.ZP,function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},s=Object.keys(i);"function"===typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(i).filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable})))),s.forEach((function(t){n(e,t,i[t])}))}return e}({mode:"java",theme:"github",width:"100%",minLines:4,maxLines:4,showPrintMargin:!1,onBeforeLoad:function(e){e.config.set("basePath","https://cdn.jsdelivr.net/npm/ace-builds@".concat(e.version,"/src-min-noconflict"))}},e))}},3856:function(e,t,i){"use strict";var s=i(4246),r=i(7378);t.Z=function(e){var t=e.recordReplayer,i=(0,r.useState)(!1),n=i[0],o=i[1],a=(0,r.useState)("paused"),c=a[0],h=a[1];(0,r.useEffect)((function(){t.addStateListener((function(e){return h(e)})),t.addEventListener((function(e){"ended"===e&&l(100)}))}),[t]);var d=(0,r.useState)(0),u=d[0],l=d[1],p=(0,r.useCallback)((function(e){t.percent=e.target.value,l(e.target.value)}),[t]),f=(0,r.useRef)();(0,r.useEffect)((function(){"playing"===c?f.current=setInterval((function(){l(t.percent)}),100):f.current&&clearInterval(f.current)}),[c,t]);var g=(0,r.useState)("1.0"),m=g[0],y=g[1];return(0,r.useEffect)((function(){t.playbackRate=parseFloat(m)}),[m,t]),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:{display:"flex",width:"100%",flexDirection:"row",alignItems:"center"},children:[(0,s.jsx)("button",{onClick:function(){"paused"===c?t.play():"recording"===c?t.stop():t.pause()},children:"paused"===c?(0,s.jsx)(s.Fragment,{children:"Play"}):"recording"===c?(0,s.jsx)(s.Fragment,{children:"Stop"}):(0,s.jsx)(s.Fragment,{children:"Pause"})}),(0,s.jsx)("button",{disabled:"paused"!==c,onClick:function(){t.record()},children:"Record"}),(0,s.jsxs)("select",{id:"playbackRate",onChange:function(e){return y(e.target.value)},value:m.toString(),children:[(0,s.jsx)("option",{value:"0.5",children:"0.5"}),(0,s.jsx)("option",{value:"1.0",children:"1.0"}),(0,s.jsx)("option",{value:"2.0",children:"2.0"})]})]}),(0,s.jsx)("input",{disabled:"recording"===c,type:"range",min:"0",max:"100",step:"1",onChange:p,onMouseDown:function(){"playing"!==c||n||(o(!0),t.pause())},onMouseUp:function(){n&&t.play(),o(!1)},value:u,style:{width:"100%"}})]})}},8741:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeAceRecordTimestamp=t.AceTrace=t.AceTraceContent=t.AceRecord=t.ExternalChange=t.SessionInfo=t.WindowSizeChange=t.WindowSize=t.ScrollChange=t.ScrollPosition=t.CursorChange=t.SelectionChange=t.Selection=t.Delta=t.Complete=t.EditorLocation=t.AceTimestamp=void 0;const s=i(4690);t.AceTimestamp=(0,s.Union)((0,s.InstanceOf)(Date),s.String.withConstraint((e=>!isNaN(Date.parse(e).valueOf())))),t.EditorLocation=(0,s.Record)({row:s.Number,column:s.Number}),t.Complete=(0,s.Record)({type:(0,s.Literal)("complete"),timestamp:t.AceTimestamp,focused:s.Boolean,value:s.String,selection:(0,s.Record)({start:t.EditorLocation,end:t.EditorLocation}),cursor:t.EditorLocation,scroll:(0,s.Record)({top:s.Number,left:s.Number}),window:(0,s.Record)({width:s.Number,height:s.Number,rows:s.Number,fontSize:s.Number,lineHeight:s.Number}),reason:(0,s.Union)((0,s.Literal)("start"),(0,s.Literal)("timer"),(0,s.Literal)("end"),(0,s.Literal)("manual"),(0,s.Literal)("session"))}).And((0,s.Partial)({sessionName:s.String})),t.Delta=(0,s.Record)({type:(0,s.Literal)("delta"),timestamp:t.AceTimestamp,focused:s.Boolean,start:t.EditorLocation,end:t.EditorLocation,action:(0,s.Union)((0,s.Literal)("insert"),(0,s.Literal)("remove")),lines:(0,s.Array)(s.String)}).And((0,s.Partial)({id:s.Number})),t.Selection=(0,s.Record)({start:t.EditorLocation,end:t.EditorLocation}),t.SelectionChange=(0,s.Record)({type:(0,s.Literal)("selectionchange"),timestamp:t.AceTimestamp,focused:s.Boolean,start:t.EditorLocation,end:t.EditorLocation}),t.CursorChange=(0,s.Record)({type:(0,s.Literal)("cursorchange"),timestamp:t.AceTimestamp,focused:s.Boolean,location:t.EditorLocation}),t.ScrollPosition=(0,s.Record)({top:s.Number,left:s.Number}),t.ScrollChange=(0,s.Record)({type:(0,s.Literal)("scrollchange"),timestamp:t.AceTimestamp,focused:s.Boolean,top:s.Number,left:s.Number,triggeredByCursorChange:s.Boolean}),t.WindowSize=(0,s.Record)({width:s.Number,height:s.Number,rows:s.Number,fontSize:s.Number,lineHeight:s.Number}),t.WindowSizeChange=(0,s.Record)({type:(0,s.Literal)("windowsizechange"),timestamp:t.AceTimestamp,focused:s.Boolean,rows:s.Number}),t.SessionInfo=(0,s.Record)({name:s.String,contents:s.String,mode:s.String}),t.ExternalChange=(0,s.Record)({type:(0,s.Literal)("external"),timestamp:t.AceTimestamp}),t.AceRecord=(0,s.Union)(t.Complete,t.Delta,t.SelectionChange,t.CursorChange,t.ScrollChange,t.WindowSizeChange,t.ExternalChange),t.AceTraceContent=(0,s.Record)({records:(0,s.Array)(t.AceRecord),duration:s.Number,startTime:t.AceTimestamp,sessionInfo:(0,s.Array)(t.SessionInfo)}).And((0,s.Partial)({sessionName:s.String}));t.AceTrace=class{constructor(e,i,s){if(0===e.length)throw new Error("Empty trace");if(this.records=e,this.startTime=new Date(e[0].timestamp),this.duration=new Date(e.slice(-1)[0].timestamp).valueOf()-new Date(e[0].timestamp).valueOf(),i.length>1&&i.find((({name:e})=>!e)))throw new Error("Session names must not be blank");if(!i.find((({name:e})=>e===s)))throw new Error("Must set sessionName when trace includes multiple sessions");this.sessionInfo=i,this.sessionName=s,t.AceTraceContent.check(this)}};t.deserializeAceRecordTimestamp=e=>(e.timestamp=new Date(e.timestamp),e)}}]);