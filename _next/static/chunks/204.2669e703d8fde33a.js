"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[204],{8555:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(r,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=r(i(1339)),o=r(i(1257)),a=r(i(6624));class c{constructor(...e){this._audio=new a.default,this.emitter=new n.default,this._state="paused",this.tolerance=.1,this.hasRecording=!1,this._ace=new o.default(...e),this._audio.addStateListener(e=>{if(this._state!==e){if(this._ace.state!==e&&"paused"===e)try{this._ace.pause()}catch(e){}this.state=e}}),this.audio.player.addEventListener("ended",()=>{this.emitter.emit("event","ending"),this.currentTime=0,this.emitter.emit("event","ended")}),this.audio.player.addEventListener("waiting",()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}}),this.audio.player.addEventListener("stalled",()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}}),this.audio.player.addEventListener("playing",()=>{if("playing"!==this._ace.state)try{this._ace.currentTime=this._audio.currentTime,this._ace.play()}catch(e){}}),this.audio.player.addEventListener("pause",()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}}),this.audio.player.addEventListener("timeupdate",()=>{Math.abs(this._ace.currentTime-this._audio.currentTime)>this.tolerance&&(this._ace.currentTime=this._audio.currentTime)})}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",this._state))}play(){return s(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");this.emitter.emit("event","starting"),yield this._audio.play(),this.state="playing"})}pause(){if("playing"!==this.state)throw Error("Not playing");this._audio.pause(),this.state="paused"}record(){return s(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");this.emitter.emit("event","startingRecording"),yield this._audio.record(),yield this._ace.record(),this.state="recording",this.emitter.emit("event","startedRecording")})}stop(){return s(this,void 0,void 0,function*(){if("recording"!==this.state)throw Error("Not recording");if(this.hasRecording=!0,yield this._audio.stop(),yield this._ace.stop(),Math.abs(this._audio.duration-this._ace.duration)>100)throw this.hasRecording=!1,Error(`Recordings do not have equal length: Audio ${this._audio.duration} <-> Ace ${this._ace.duration}`);this.hasRecording&&this.emitter.emit("event","srcChanged"),this.state="paused"})}addStateListener(e){this.emitter.addListener("state",e)}addEventListener(e){this.emitter.addListener("event",e)}set src(e){if("playing"===this.state||"recording"===this.state)throw Error("Can't change source while recording or playing");this._ace.src=e?e.ace:void 0,this._audio.src=e?e.audio:"",this.hasRecording=!1,this.state="paused",this.emitter.emit("event","srcChanged")}get src(){if("recording"===this.state)throw Error("Still recording");return this._ace.src?{ace:this._ace.src,audio:this._audio.src}:void 0}get currentTime(){return this._audio.currentTime}set currentTime(e){this._audio.currentTime=e,this._ace.currentTime=e,this._ace.sync(),this.emitter.emit("event","seeked")}get percent(){return this._audio.percent}set percent(e){this._audio.percent=e,this._ace.percent=e,this._ace.sync(),this.emitter.emit("event","seeked")}get ace(){return this._ace}get audio(){return this._audio}set playbackRate(e){this._audio.playbackRate=e,this._ace.playbackRate=e,this.emitter.emit("event","playbackRateChange")}get playbackRate(){return this._audio.playbackRate}get duration(){return this._audio.duration}}t.default=c},6151:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(r,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=r(i(1339)),o=r(i(1707)),a=r(i(6624));class c{constructor(...e){this._audio=new a.default,this.emitter=new n.default,this._state="paused",this.tolerance=.1,this.hasRecording=!1,this._ace=new o.default(...e),this._audio.addStateListener(e=>{if(this._state!==e){if(this._ace.state!==e&&"paused"===e)try{this._ace.pause()}catch(e){}this.state=e}}),this.audio.player.addEventListener("ended",()=>{this.emitter.emit("event","ending"),this.currentTime=0,this.emitter.emit("event","ended")}),this.audio.player.addEventListener("waiting",()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}}),this.audio.player.addEventListener("stalled",()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}}),this.audio.player.addEventListener("playing",()=>{if("playing"!==this._ace.state)try{this._ace.currentTime=this._audio.currentTime,this._ace.play()}catch(e){}}),this.audio.player.addEventListener("pause",()=>{if("paused"!==this._ace.state)try{this._ace.pause()}catch(e){}}),this.audio.player.addEventListener("timeupdate",()=>{Math.abs(this._ace.currentTime-this._audio.currentTime)>this.tolerance&&(this._ace.currentTime=this._audio.currentTime)})}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",this._state))}play(){return s(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");if(!this.src)throw Error("No source");this.emitter.emit("event","starting"),yield this._audio.play(),this.state="playing"})}pause(){if("playing"!==this.state)throw Error("Not playing");this._audio.pause(),this.state="paused"}record(){return s(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");this.emitter.emit("event","startingRecording"),yield this._audio.record(),yield this._ace.record(),this.state="recording",this.emitter.emit("event","startedRecording")})}stop(){return s(this,void 0,void 0,function*(){if("recording"!==this.state)throw Error("Not recording");if(this.hasRecording=!0,yield this._audio.stop(),yield this._ace.stop(),Math.abs(this._audio.duration-this._ace.duration)>100)throw this.hasRecording=!1,Error(`Recordings do not have equal length: Audio ${this._audio.duration} <-> Ace ${this._ace.duration}`);this.hasRecording&&this.emitter.emit("event","srcChanged"),this.state="paused"})}addStateListener(e){this.emitter.addListener("state",e)}addEventListener(e){this.emitter.addListener("event",e)}set src(e){if("playing"===this.state||"recording"===this.state)throw Error("Can't change source while recording or playing");this._ace.src=e?e.ace:void 0,this._audio.src=e?e.audio:"",this.hasRecording=!1,this.state="paused",this.emitter.emit("event","srcChanged")}get src(){if("recording"===this.state)throw Error("Still recording");return this._ace.src?{ace:this._ace.src,audio:this._audio.src}:void 0}get currentTime(){return this._audio.currentTime}set currentTime(e){this._audio.currentTime=e,this._ace.currentTime=e,this._ace.sync(),this.emitter.emit("event","seeked")}get percent(){return this._audio.percent}set percent(e){this._audio.percent=e,this._ace.percent=e,this._ace.sync(),this.emitter.emit("event","seeked")}get ace(){return this._ace}get audio(){return this._audio}set playbackRate(e){this._audio.playbackRate=e,this._ace.playbackRate=e,this.emitter.emit("event","playbackRateChange")}get playbackRate(){return this._audio.playbackRate}get duration(){return this._audio.duration}}t.default=c},1257:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(r,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=r(i(1339)),o=r(i(2136)),a=r(i(9974));class c{constructor(e,t){for(let i of(this.players={},this.recorders={},this._state="paused",this.emitter=new n.default,this.stopping=!1,this.hasRecording=!1,Object.keys(e)))this.players[i]=new o.default((null==t?void 0:t.replayEditors)?t.replayEditors[i]:e[i],{filterRecord:e=>null==t||!t.filterRecord||t.filterRecord(e,i)}),this.recorders[i]=new a.default(e[i])}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",e))}get state(){return this._state}play(){return s(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");for(let e of Object.keys(this.players))yield this.players[e].play();this.state="playing"})}pause(){if("playing"!==this.state)throw Error("Not playing");for(let e of Object.keys(this.players))this.players[e].pause();this.state="paused"}sync(){for(let e of Object.keys(this.players))this.players[e].sync()}record(){return s(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");for(let e of Object.keys(this.recorders))this.recorders[e].start();this.state="recording",this.hasRecording=!0})}stop(){return s(this,void 0,void 0,function*(){if("recording"!==this.state)throw Error("Not recording");this.stopping=!0;let e={};for(let t of Object.keys(this.recorders))this.recorders[t].stop(),e[t]=this.recorders[t].src;this.src=e,this.state="paused",this.stopping=!1})}addStateListener(e){this.emitter.addListener("state",e)}addEventListener(e){this.emitter.addListener("event",e)}get currentTime(){return this.players[Object.keys(this.players)[0]].currentTime}set currentTime(e){for(let t of Object.keys(this.players))this.players[t].currentTime=e}get playbackRate(){return this.players[Object.keys(this.players)[0]].playbackRate}set playbackRate(e){for(let t of Object.keys(this.players))this.players[t].playbackRate=e}get duration(){return this.players[Object.keys(this.players)[0]].duration}get percent(){return this.currentTime/this.duration*100}set percent(e){this.currentTime=this.duration*e/100}set src(e){if(!this.stopping&&("playing"===this.state||"recording"===this.state))throw Error("Can't change src while playing or recording");if(this._src=e,e)for(let t of Object.keys(e))this.players[t].src=e[t];this.state="paused",this.hasRecording=!1}get src(){if("recording"===this.state)throw Error("Still recording");return this._src}}t.default=c},2136:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(r,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=i(8741),o=r(i(8817)),a=r(i(1339));class c extends a.default{constructor(e,t){super(),this._currentTime=0,this.currentIndex=0,this.endIndex=0,this.traceTimes=[],this.traceIndex={},this.playing=!1,this.scrollToCursor=!1,this.sessionMap={},this._editor=e,this.filterRecord=null==t?void 0:t.filterRecord;let i=this._editor.renderer;this.wasVisible=i.$cursorLayer.isVisible,this.wasBlinking=i.$cursorLayer.isBlinking,this.previousOpacity=i.$cursorLayer.element.style.opacity,this._playbackRate=1}set src(e){if(!e){this._trace=e;return}if(this._trace=e,this.endIndex=e.records.length,this.traceTimes=this._trace.records.map((t,i)=>{let s=n.Complete.guard(t),r=new Date(t.timestamp).valueOf()-new Date(e.startTime).valueOf();return s&&(this.traceIndex[Math.ceil(r/1e3)]=i),{complete:s,offset:r}}),this._trace.sessionName){for(let{name:e,contents:t,mode:i}of(this.sessionMap={},this._trace.sessionInfo))this.sessionMap[e]=o.default.createEditSession(t,i);this.setSession(this._trace.sessionName)}let t=0;for(let e=0;e<Math.floor(this.traceTimes[this.endIndex-1].offset)/1e3;e++)this.traceIndex[e]?t=e:this.traceIndex[e]=t}get src(){return this._trace}getSessionsInfo(){return Object.entries(this.sessionMap).map(([e,t])=>({name:e,contents:t.getValue(),mode:""}))}play(){return s(this,void 0,void 0,function*(){if(!this._trace)throw Error("No trace loaded");let e=this._editor.renderer;e.$cursorLayer.isVisible=!0,e.$cursorLayer.setBlinking(!0),e.$cursorLayer.element.style.opacity=1,this.currentTime=this._currentTime/1e3,this.syncTime=new Date().valueOf(),this.startTime=this.syncTime-this._currentTime/this.playbackRate,this.playing=!0,this.next(!1)})}clearTimeout(){this.timer&&(clearTimeout(this.timer),this.timer=void 0,this.timerStarted=void 0)}setSession(e){if(!this.sessionMap[e])throw Error(`Session ${e} does not exist`);this.sessionName=e,this._editor.setSession(this.sessionMap[e])}sync(){let e;if(!this._trace)throw Error("Can't sync without trace");let t=-1;for(e=this.currentIndex;e<this.endIndex&&!((t=this.startTime+this.traceTimes[e].offset/this.playbackRate-this.syncTime)>0);e++){let t=this._trace.records[e];!1!==(!this.filterRecord||this.filterRecord(t))&&(n.Complete.guard(t)&&t.sessionName&&(this.setSession(t.sessionName),t.sessionInfo&&t.sessionInfo.forEach(e=>{e.name!==this.sessionName&&this.sessionMap[e.name].setValue(e.contents)})),n.ScrollPosition.guard(t)&&this.scrollToCursor&&t.triggeredByCursorChange||(h(this._editor,t,!this.scrollToCursor),this.emit("record",t)),(n.Delta.guard(t)||n.CursorChange.guard(t)||n.SelectionChange.guard(t))&&this.scrollToCursor&&this._editor.renderer.scrollCursorIntoView(this._editor.session.selection.getCursor()))}return this.playing&&this.currentIndex===this.endIndex&&(this.playing=!1),this.currentIndex=e,t}next(e=!0){if(!this._trace)throw Error("Timer shouldn't fire when trace is empty");if(!this.playing)return;this.clearTimeout();let t=new Date().valueOf();e&&(this.syncTime=t,this._currentTime=(t-this.startTime)*this._playbackRate);let i=this.sync();i>0&&(this.timerStarted=new Date().valueOf(),this.timer=setTimeout(()=>{this.next()},i))}pause(e=!0){if(this.timerStarted&&(this._currentTime+=(new Date().valueOf()-this.timerStarted)*this.playbackRate),this.clearTimeout(),this.playing=!1,e){let e=this._editor.renderer;e.$cursorLayer.element.style.opacity=this.previousOpacity,e.$cursorLayer.setBlinking(this.wasBlinking),e.$cursorLayer.isVisible=this.wasVisible}}get duration(){return this._trace.duration/1e3}get currentTime(){return this.playing?(new Date().valueOf()-this.startTime)*this.playbackRate/1e3:this._currentTime/1e3}set currentTime(e){if(e<0||e>this.duration+.1)throw Error(`Bad timestamp: ${e}`);let t=1e3*e;this.syncTime=new Date().valueOf(),this.startTime=this.syncTime-t/this.playbackRate;let i=-1,s=Math.floor(e),r=this.traceIndex[s];if(void 0===r)throw Error(`Couldn't find index for ${s}: ${e}`);if(this.traceTimes[r].offset>t)throw Error(`Bad index value: ${r}`);for(let e=r;e<this.traceTimes.length;e++){let s=this.traceTimes[e];if(s.complete){if(s.offset>t)break;i=e}}this.currentIndex=i,this._currentTime=t}get playbackRate(){return this._playbackRate}set playbackRate(e){let t=this.playing;this.playing&&this.pause(!1),this._playbackRate=e,t&&this.play()}get editor(){return this._editor}}t.default=c;let h=(e,t,i=!0)=>{n.Complete.guard(t)?d(e.session,t,i):n.Delta.guard(t)?l(e.session,t):n.SelectionChange.guard(t)?u(e.session,t):n.CursorChange.guard(t)?p(e.session,t):n.ScrollChange.guard(t)&&f(e.renderer,t)},d=(e,t,i=!0)=>{e.getValue()!==t.value&&m(e,t.value);let{row:s,column:r}=t.cursor;e.selection.moveCursorTo(s,r);let{start:n,end:o}=t.selection;if(e.selection.setSelectionRange({start:{row:n.row,column:n.column},end:{row:o.row,column:o.column}}),i){let{top:i,left:s}=t.scroll;e.setScrollTop(i),e.setScrollLeft(s)}},l=(e,t)=>e.getDocument().applyDelta(t),u=(e,t)=>e.selection.setSelectionRange(t),p=(e,t)=>e.selection.moveCursorTo(t.location.row,t.location.column),f=(e,t)=>{e.scrollToY(t.top),e.scrollToX(t.left)},m=(e,t)=>{let i=e.selection.toJSON();e.setValue(t),e.selection.fromJSON(i)}},1707:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(r,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=r(i(1339)),o=r(i(2136)),a=r(i(9974));class c extends o.default{constructor(e,t){var i;super(null!==(i=null==t?void 0:t.replayEditor)&&void 0!==i?i:e,{filterRecord:null==t?void 0:t.filterRecord}),this._state="paused",this.emitter=new n.default,this.stopping=!1,this.hasRecording=!1,this.recorder=new a.default(e)}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",e))}get state(){return this._state}play(){let e=Object.create(null,{play:{get:()=>super.play}});return s(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");yield e.play.call(this),this.state="playing"})}pause(){if("playing"!==this.state)throw Error("Not playing");super.pause(),this.state="paused"}record(){return s(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");this.recorder.start(),this.state="recording"})}stop(){return s(this,void 0,void 0,function*(){if("recording"!==this.state)throw Error("Not recording");this.recorder.stop(),this.stopping=!0,this.src=this.recorder.src,this.state="paused",this.stopping=!1,this.hasRecording=!0})}addStateListener(e){this.emitter.addListener("state",e)}addEventListener(e){this.emitter.addListener("event",e)}get percent(){return this.currentTime/this.duration*100}set percent(e){this.currentTime=this.duration*e/100}set src(e){if(!this.stopping&&("playing"===this.state||"recording"===this.state))throw Error("Can't change src while playing or recording");super.src=e,this.state="paused",this.hasRecording=!1}get src(){if("recording"===this.state)throw Error("Still recording");return super.src}}t.default=c},9974:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var r=Object.getOwnPropertyDescriptor(t,i);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,r)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&s(t,e,i);return r(t,e),t},o=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(r,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let c=i(8741),h=a(i(8817)),d=a(i(1339)),l=n(i(8494));class u extends d.default{constructor(e,t){super(),this.recording=!1,this.records=[],this.sessionMap={},this.startSession="",this.sessionInfo=[],this.editor=e,this.streamer=new l.default(e),this.options=t}start(){var e;return o(this,void 0,void 0,function*(){let t=(null===(e=this.options)||void 0===e?void 0:e.completeInterval)||1e3;if(this.records=[],this.src=void 0,0===Object.keys(this.sessionMap).length&&void 0===this.sessionName)this.sessionMap[""]={session:this.editor.getSession(),mode:this.editor.getSession().$modeId},this.sessionName="";else if(0===Object.keys(this.sessionMap).length||void 0===this.sessionName)throw Error(`Session information not properly configured: ${this.sessionName}`);this.sessionInfo=Object.entries(this.sessionMap).map(([e,t])=>({name:e,contents:t.session.getValue(),mode:t.mode})),this.startSession=this.sessionName||"",this.streamer.start(e=>{if(c.Complete.guard(e)){let t=[...Object.keys(this.sessionMap)].map(e=>({name:e,contents:this.sessionMap[e].session.getValue(),mode:this.sessionMap[e].mode}));e.sessionInfo=t}this.records.push(e),this.emit("record",e)}),this.timer=setInterval(()=>{this.addCompleteRecord("timer")},t),this.recording=!0})}stop(){return o(this,void 0,void 0,function*(){if(!this.recording)throw Error("Not recording");this.recording=!1,this.timer&&clearInterval(this.timer),this.streamer.stop(),this.src=new c.AceTrace([...this.records],this.sessionInfo,this.startSession)})}addCompleteRecord(e="manual"){if(!this.recording)throw Error("Not recording");let t=(0,l.getComplete)(this.editor,e,this.sessionName,this._external),i=[...Object.keys(this.sessionMap)].map(e=>({name:e,contents:this.sessionMap[e].session.getValue(),mode:this.sessionMap[e].mode}));t.sessionInfo=i,this.records.push(t),this.emit("record",t)}addSession(e){let{name:t,contents:i,mode:s}=e;if(this.sessionMap[t])throw Error(`Session ${t} already exists`);this.recording&&this.sessionInfo.push({name:t,contents:i,mode:s}),this.sessionMap[t]={session:h.default.createEditSession(i,s),mode:s}}addSessions(e){for(let t of e)this.addSession(t)}getSessionsInfo(){return Object.entries(this.sessionMap).map(([e,t])=>({name:e,contents:t.session.getValue(),mode:t.mode}))}clearSessions(){if(this.recording)throw Error("cannot clear sessions while recording");this.sessionMap={}}setSession(e){if(!this.sessionMap[e])throw Error(`Session ${e} does not exist`);this.sessionName=this.streamer.sessionName=e,this.editor.setSession(this.sessionMap[e].session)}singleSession(e){if(Object.keys(this.sessionMap).length>0)throw Error("Session map must be empty when calling singleSession");this.addSession(e),this.sessionName=e.name}set external(e){if(void 0!==e.type)throw Error("type property in external changes is overwritten");if(this._external=e,this.streamer.external=e,this.recording){let t=c.ExternalChange.check({external:e,type:"external",timestamp:new Date});this.records.push(t),this.emit("record",t)}}}t.default=u},8494:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getComplete=void 0;let s=i(8741),r=i(2691);class n{constructor(e){this._stop=()=>{},this.running=!1,this.editor=e}start(e){let i=!1,n=this.editor.renderer,{width:h,height:d}=n.$size,l=s.WindowSize.check({width:h,height:d,rows:0===d?0:this.editor.renderer.getScrollBottomRow()-this.editor.renderer.getScrollTopRow()+1,fontSize:parseInt(this.editor.getFontSize()),lineHeight:n.$textLayer.getLineHeight()}),u=(0,r.throttle)(100,()=>{if(!this.running)return;i=!1;let{width:t,height:r}=n.$size,o=s.WindowSize.check({width:t,height:r,rows:0===r?0:this.editor.renderer.getScrollBottomRow()-this.editor.renderer.getScrollTopRow()+1,fontSize:parseInt(this.editor.getFontSize()),lineHeight:n.$textLayer.getLineHeight()});null!==o.rows&&void 0!==o.rows&&(o.width!==l.width||o.height!==l.height||o.rows!==l.rows||o.fontSize!==l.fontSize||o.lineHeight!==l.lineHeight)&&(h=t,d=r,l=o,e(s.WindowSizeChange.check(Object.assign({type:"windowsizechange",timestamp:new Date,focused:this.editor.isFocused()},o))))}),p=this.editor.getValue(),f=t=>{this.running&&(i=!1,this.editor.getValue()!==p&&(p=this.editor.getValue(),e(s.Delta.check(Object.assign({type:"delta",timestamp:new Date,focused:this.editor.isFocused()},t)))))},m=s.Selection.check(this.editor.selection.getRange()),g=(0,r.throttle)(100,()=>{if(!this.running)return;i=!1;let t=s.Selection.check(this.editor.selection.getRange());if(a(t,m)||c(t)){m=t;return}m=t,e(s.SelectionChange.check(Object.assign({type:"selectionchange",timestamp:new Date,focused:this.editor.isFocused()},t)))}),y=s.EditorLocation.check(this.editor.selection.getCursor()),_=(0,r.throttle)(100,()=>{if(!this.running)return;i=!1;let t=s.EditorLocation.check(this.editor.selection.getCursor());if(o(t,y)||!c(this.editor.selection.getRange())){y=t;return}y=t,e(s.CursorChange.check({type:"cursorchange",timestamp:new Date,focused:this.editor.isFocused(),location:t}))}),v=s.ScrollPosition.check({top:this.editor.renderer.getScrollTop(),left:this.editor.renderer.getScrollLeft()}),w=(0,r.throttle)(100,()=>{if(!this.running)return;let t=i;i=!1;let r=this.editor.renderer.getScrollTop();r<0&&(r=0),r>d&&(r=d);let n=this.editor.renderer.getScrollLeft();n<0&&(n=0),n>h&&(n=h);let o=s.ScrollPosition.check({top:r,left:n});(o.top!==v.top||o.left!==v.left)&&(v=o,e(s.ScrollChange.check(Object.assign({type:"scrollchange",timestamp:new Date,focused:this.editor.isFocused(),triggeredByCursorChange:t},o))))}),b=({session:s,oldSession:r})=>{if(i=!1,r.removeEventListener("change",f),r.removeEventListener("changeScrollTop",w),r.removeEventListener("changeScrollTop",u),!this.sessionName)throw Error("Must set sessionName if switching sessions during recording");e((0,t.getComplete)(this.editor,"session",this.sessionName,this._external)),s.addEventListener("change",f),s.addEventListener("changeScrollTop",w),s.addEventListener("changeScrollTop",u)},S=()=>{i=!0};e((0,t.getComplete)(this.editor,"start",this.sessionName,this._external)),this.editor.session.addEventListener("change",f),this.editor.addEventListener("changeSelection",g),this.editor.addEventListener("changeSelection",_),this.editor.session.addEventListener("changeScrollTop",w),this.editor.renderer.addEventListener("resize",u),this.editor.addEventListener("changeSession",b),this.editor.addEventListener("beforeEndOperation",S),this.running=!0,this._stop=()=>{this.editor.removeEventListener("beforeEndOperation",S),this.editor.removeEventListener("changeSession",b),this.editor.session.removeEventListener("resize",u),this.editor.session.removeEventListener("changeScrollTop",w),this.editor.removeEventListener("changeSelection",_),this.editor.removeEventListener("changeSelection",g),this.editor.session.removeEventListener("change",f),e((0,t.getComplete)(this.editor,"end",this.sessionName,this._external)),this.running=!1}}stop(){if(!this.running)throw Error("Not running");this._stop(),this._stop=()=>{}}set external(e){this._external=e}}t.default=n;let o=(e,t)=>e.column===t.column&&e.row===t.row,a=(e,t)=>o(e.start,t.start)&&o(e.end,t.end);t.getComplete=(e,t,i,r)=>{let n=e.renderer,{width:o,height:a}=n.$size;return s.Complete.check(Object.assign(Object.assign({type:"complete",timestamp:new Date,focused:e.isFocused(),value:e.session.getValue(),selection:e.session.selection.getRange(),cursor:e.session.selection.getCursor(),scroll:{top:e.renderer.getScrollTop(),left:e.renderer.getScrollLeft()},window:{width:o,height:a,rows:0===a?0:e.renderer.getScrollBottomRow()-e.renderer.getScrollTopRow()+1,fontSize:parseInt(e.getFontSize()),lineHeight:n.$textLayer.getLineHeight()},reason:t},i&&{sessionName:i}),r&&{external:r}))};let c=e=>e.start.column===e.end.column&&e.start.row===e.end.row},6624:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(r,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=r(i(1339)),o=r(i(3285));class a{constructor(){this.recorder=new o.default,this._state="paused",this.emitter=new n.default,this.stopping=!1,this._playbackRate=1,this.hasRecording=!1,this.player=new Audio,this.player.addEventListener("ended",()=>{this.emitter.emit("ended"),this.state="paused"})}set state(e){e!==this._state&&(this._state=e,this.emitter.emit("state",e))}get state(){return this._state}play(){return s(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");this.player.playbackRate=this._playbackRate,yield this.player.play(),this.state="playing"})}pause(){if("playing"!==this.state)throw Error("Not playing");this.player.pause(),this.state="paused"}record(){return s(this,void 0,void 0,function*(){if("paused"!==this.state)throw Error("Not paused");yield this.recorder.start(),this.state="recording"})}stop(){return s(this,void 0,void 0,function*(){if("recording"!==this.state)throw Error("Not recording");yield this.recorder.stop(),this.stopping=!0,this.src=this.recorder.src,this.state="paused",this.stopping=!1,this.hasRecording=!0})}set src(e){if(!this.stopping&&("playing"===this.state||"recording"===this.state))throw Error("Can't change src while playing or recording");this.player.src=e,this.player.playbackRate=this.playbackRate,""!==e&&this.player.load(),this.state="paused",this.hasRecording=!1}get src(){if("recording"===this.state)throw Error("Still recording");return this.player.src}addStateListener(e){this.emitter.addListener("state",e)}addEventListener(e){this.emitter.addListener("event",e)}get currentTime(){return this.player.currentTime}set currentTime(e){this.player.currentTime=e}get percent(){return this.player.currentTime/this.player.duration*100}set percent(e){this.player.currentTime=this.player.duration*e/100}get playbackRate(){return this.player.playbackRate}set playbackRate(e){this._playbackRate=e,this.player.playbackRate=e}get duration(){return this.player.duration}}t.default=a},3285:function(e,t,i){var s=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(r,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let n=r(i(1012)),o=r(i(5149));class a{constructor(){this.started=0,this.chunks=[]}start(){return s(this,void 0,void 0,function*(){return this.recorder=new MediaRecorder((yield navigator.mediaDevices.getUserMedia({audio:!0}))),this.listener=({data:e})=>{e&&e.size>0&&this.chunks.push(e)},this.recorder.addEventListener("dataavailable",this.listener),this.blob=void 0,new Promise((e,t)=>{this.blob=void 0,this.recorder.addEventListener("start",()=>{this.chunks=[],this.started=Date.now(),e()},{once:!0}),this.recorder.addEventListener("error",t,{once:!0}),this.recorder.start(1e3)})})}stop(){return s(this,void 0,void 0,function*(){return new Promise(e=>{this.recorder.addEventListener("stop",()=>s(this,void 0,void 0,function*(){let t=Date.now()-this.started;this.recorder.removeEventListener("dataavailable",this.listener),this.recorder.stream.getTracks()[0].stop(),this.blob=new Blob(this.chunks,{type:this.recorder.mimeType}),"webm"===new o.default(this.recorder.mimeType).subtype&&(this.blob=yield(0,n.default)(new Blob(this.chunks,{type:this.recorder.mimeType}),t,{logger:!1})),e()}),{once:!0}),this.recorder.stop()})})}get src(){return this.blob&&URL.createObjectURL(this.blob)}}t.default=a},9155:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var r=Object.getOwnPropertyDescriptor(t,i);(!r||("get"in r?!t.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,r)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),r=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)},n=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(r,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function a(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?r(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,a)}c((s=s.apply(e,t||[])).next())})},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.urlToBase64=t.MultiRecordReplayer=t.AudioRecordReplayer=t.AudioRecorder=t.AceMultiRecordReplayer=t.AceRecordReplayer=t.AceRecorder=t.AcePlayer=t.AceStreamer=void 0;let a=o(i(8494));t.AceStreamer=a.default;let c=o(i(2136));t.AcePlayer=c.default;let h=o(i(9974));t.AceRecorder=h.default;let d=o(i(1707));t.AceRecordReplayer=d.default;let l=o(i(1257));t.AceMultiRecordReplayer=l.default;let u=o(i(3285));t.AudioRecorder=u.default;let p=o(i(6624));t.AudioRecordReplayer=p.default;let f=o(i(6151)),m=o(i(8555));t.MultiRecordReplayer=m.default,t.default=f.default,t.urlToBase64=e=>n(void 0,void 0,void 0,function*(){let t=yield fetch(e).then(e=>e.blob());return new Promise(e=>{let i=new FileReader;i.onloadend=()=>e(i.result.toString().split(",")[1]),i.readAsDataURL(t)})}),r(i(8741),t)},6840:function(e,t,i){var s=i(4246),r=i(2329);t.Z=e=>(0,s.jsx)(r.ZP,{mode:"java",theme:"github",width:"100%",minLines:4,maxLines:4,showPrintMargin:!1,onBeforeLoad:e=>{e.config.set("basePath","https://cdn.jsdelivr.net/npm/ace-builds@".concat(e.version,"/src-min-noconflict"))},...e})},3722:function(e,t,i){var s=i(4246),r=i(7378);t.Z=e=>{let{recordReplayer:t}=e,[i,n]=(0,r.useState)(!1),[o,a]=(0,r.useState)("paused");(0,r.useEffect)(()=>{t.addStateListener(e=>a(e)),t.addEventListener(e=>{"ended"===e&&h(100)})},[t]);let[c,h]=(0,r.useState)(0),d=(0,r.useCallback)(e=>{t.percent=e.target.value,h(e.target.value)},[t]),l=(0,r.useRef)();(0,r.useEffect)(()=>{"playing"===o?l.current=setInterval(()=>{h(t.percent)},100):l.current&&clearInterval(l.current)},[o,t]);let[u,p]=(0,r.useState)("1.0");return(0,r.useEffect)(()=>{t.playbackRate=parseFloat(u)},[u,t]),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:{display:"flex",width:"100%",flexDirection:"row",alignItems:"center"},children:[(0,s.jsx)("button",{onClick:()=>{"paused"===o?t.play():"recording"===o?t.stop():t.pause()},children:"paused"===o?(0,s.jsx)(s.Fragment,{children:"Play"}):"recording"===o?(0,s.jsx)(s.Fragment,{children:"Stop"}):(0,s.jsx)(s.Fragment,{children:"Pause"})}),(0,s.jsx)("button",{disabled:"paused"!==o,onClick:()=>{t.record()},children:"Record"}),(0,s.jsxs)("select",{id:"playbackRate",onChange:e=>p(e.target.value),value:u.toString(),children:[(0,s.jsx)("option",{value:"0.5",children:"0.5"}),(0,s.jsx)("option",{value:"1.0",children:"1.0"}),(0,s.jsx)("option",{value:"2.0",children:"2.0"})]})]}),(0,s.jsx)("input",{disabled:"recording"===o,type:"range",min:"0",max:"100",step:"1",onChange:d,onMouseDown:()=>{"playing"!==o||i||(n(!0),t.pause())},onMouseUp:()=>{i&&t.play(),n(!1)},value:c,style:{width:"100%"}})]})}},8741:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeAceRecordTimestamp=t.AceTrace=t.AceTraceContent=t.AceRecord=t.ExternalChange=t.WindowSizeChange=t.WindowSize=t.ScrollChange=t.ScrollPosition=t.CursorChange=t.SelectionChange=t.Selection=t.Delta=t.Complete=t.SessionInfo=t.EditorLocation=t.AceTimestamp=void 0;let s=i(4690);t.AceTimestamp=(0,s.Union)((0,s.InstanceOf)(Date),s.String.withConstraint(e=>!isNaN(Date.parse(e).valueOf()))),t.EditorLocation=(0,s.Record)({row:s.Number,column:s.Number}),t.SessionInfo=(0,s.Record)({name:s.String,contents:s.String,mode:s.String}),t.Complete=(0,s.Record)({type:(0,s.Literal)("complete"),timestamp:t.AceTimestamp,focused:s.Boolean,value:s.String,selection:(0,s.Record)({start:t.EditorLocation,end:t.EditorLocation}),cursor:t.EditorLocation,scroll:(0,s.Record)({top:s.Number,left:s.Number}),window:(0,s.Record)({width:s.Number,height:s.Number,rows:s.Number,fontSize:s.Number,lineHeight:s.Number}),reason:(0,s.Union)((0,s.Literal)("start"),(0,s.Literal)("timer"),(0,s.Literal)("end"),(0,s.Literal)("manual"),(0,s.Literal)("session"))}).And((0,s.Partial)({sessionName:s.String,external:(0,s.Dictionary)(s.Unknown),sessionInfo:(0,s.Array)(t.SessionInfo)})),t.Delta=(0,s.Record)({type:(0,s.Literal)("delta"),timestamp:t.AceTimestamp,focused:s.Boolean,start:t.EditorLocation,end:t.EditorLocation,action:(0,s.Union)((0,s.Literal)("insert"),(0,s.Literal)("remove")),lines:(0,s.Array)(s.String)}).And((0,s.Partial)({id:s.Number})),t.Selection=(0,s.Record)({start:t.EditorLocation,end:t.EditorLocation}),t.SelectionChange=(0,s.Record)({type:(0,s.Literal)("selectionchange"),timestamp:t.AceTimestamp,focused:s.Boolean,start:t.EditorLocation,end:t.EditorLocation}),t.CursorChange=(0,s.Record)({type:(0,s.Literal)("cursorchange"),timestamp:t.AceTimestamp,focused:s.Boolean,location:t.EditorLocation}),t.ScrollPosition=(0,s.Record)({top:s.Number,left:s.Number}),t.ScrollChange=(0,s.Record)({type:(0,s.Literal)("scrollchange"),timestamp:t.AceTimestamp,focused:s.Boolean,top:s.Number,left:s.Number}).And((0,s.Partial)({triggeredByCursorChange:s.Boolean})),t.WindowSize=(0,s.Record)({width:s.Number,height:s.Number,rows:s.Number,fontSize:s.Number,lineHeight:s.Number}),t.WindowSizeChange=(0,s.Record)({type:(0,s.Literal)("windowsizechange"),timestamp:t.AceTimestamp,focused:s.Boolean,rows:s.Number}),t.ExternalChange=(0,s.Record)({type:(0,s.Literal)("external"),timestamp:t.AceTimestamp}),t.AceRecord=(0,s.Union)(t.Complete,t.Delta,t.SelectionChange,t.CursorChange,t.ScrollChange,t.WindowSizeChange,t.ExternalChange),t.AceTraceContent=(0,s.Record)({records:(0,s.Array)(t.AceRecord),duration:s.Number,startTime:t.AceTimestamp,sessionInfo:(0,s.Array)(t.SessionInfo)}).And((0,s.Partial)({sessionName:s.String}));class r{constructor(e,i,s){if(0===e.length)throw Error("Empty trace");if(this.records=e,this.startTime=new Date(e[0].timestamp),this.duration=new Date(e.slice(-1)[0].timestamp).valueOf()-new Date(e[0].timestamp).valueOf(),i.length>1&&i.find(({name:e})=>!e))throw Error("Session names must not be blank");if(!i.find(({name:e})=>e===s))throw Error("Must set sessionName when trace includes multiple sessions");this.sessionInfo=i,this.sessionName=s,t.AceTraceContent.check(this)}}t.AceTrace=r,t.deserializeAceRecordTimestamp=e=>(e.timestamp=new Date(e.timestamp),e)}}]);